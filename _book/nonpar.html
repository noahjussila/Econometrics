<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.251">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Advanved Econometrics with Examples - 9&nbsp; Nonparametrics I: Distribution and Density Estimation</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./references.html" rel="next">
<link href="./binary.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Nonparametrics I: Distribution and Density Estimation</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Advanved Econometrics with Examples</a> 
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">Preliminaries</a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">Statistical Theory</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./estimators.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Finite Sample Properties of Estimators</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./asymptotics.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Asymptotic Properties of Estimators</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./testing.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Hypothesis Testing</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./exp_fam.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Exponential Families</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">Linear Models</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ols.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">The Classical Linear Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./endog.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Endogeniety I: IV and 2SLS</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">Estimation Frameworks</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./extremum.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Extremum Estimators</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">Basic Microeconometrics and Time Series</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./binary.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Binary Choice</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">Advanced Topics</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./nonpar.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Nonparametrics I: Distribution and Density Estimation</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">References</a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#math-preliminaries" id="toc-math-preliminaries" class="nav-link active" data-scroll-target="#math-preliminaries"><span class="toc-section-number">9.1</span>  Math Preliminaries</a></li>
  <li><a href="#estimating-a-distribution" id="toc-estimating-a-distribution" class="nav-link" data-scroll-target="#estimating-a-distribution"><span class="toc-section-number">9.2</span>  Estimating a Distribution</a></li>
  <li><a href="#properties-of-the-empirical-distribution" id="toc-properties-of-the-empirical-distribution" class="nav-link" data-scroll-target="#properties-of-the-empirical-distribution"><span class="toc-section-number">9.3</span>  Properties of the Empirical Distribution</a>
  <ul class="collapse">
  <li><a href="#pointwise-properties" id="toc-pointwise-properties" class="nav-link" data-scroll-target="#pointwise-properties"><span class="toc-section-number">9.3.1</span>  Pointwise Properties</a></li>
  <li><a href="#empirical-process-theory" id="toc-empirical-process-theory" class="nav-link" data-scroll-target="#empirical-process-theory"><span class="toc-section-number">9.3.2</span>  Empirical Process Theory</a></li>
  </ul></li>
  <li><a href="#from-estimating-distributions-to-estimating-densities" id="toc-from-estimating-distributions-to-estimating-densities" class="nav-link" data-scroll-target="#from-estimating-distributions-to-estimating-densities"><span class="toc-section-number">9.4</span>  From Estimating Distributions to Estimating Densities</a></li>
  <li><a href="#properties-of-the-kernel-density-estimator" id="toc-properties-of-the-kernel-density-estimator" class="nav-link" data-scroll-target="#properties-of-the-kernel-density-estimator"><span class="toc-section-number">9.5</span>  Properties of the Kernel Density Estimator</a></li>
  <li><a href="#kernel-selection" id="toc-kernel-selection" class="nav-link" data-scroll-target="#kernel-selection"><span class="toc-section-number">9.6</span>  Kernel Selection</a></li>
  <li><a href="#bandwidth-selection" id="toc-bandwidth-selection" class="nav-link" data-scroll-target="#bandwidth-selection"><span class="toc-section-number">9.7</span>  Bandwidth Selection</a>
  <ul class="collapse">
  <li><a href="#silvermans-rule-of-thumb" id="toc-silvermans-rule-of-thumb" class="nav-link" data-scroll-target="#silvermans-rule-of-thumb"><span class="toc-section-number">9.7.1</span>  Silverman’s Rule of Thumb</a></li>
  <li><a href="#cross-validation" id="toc-cross-validation" class="nav-link" data-scroll-target="#cross-validation"><span class="toc-section-number">9.7.2</span>  Cross-Validation</a></li>
  </ul></li>
  <li><a href="#multivariate-kde" id="toc-multivariate-kde" class="nav-link" data-scroll-target="#multivariate-kde"><span class="toc-section-number">9.8</span>  Multivariate KDE</a></li>
  <li><a href="#extensions" id="toc-extensions" class="nav-link" data-scroll-target="#extensions"><span class="toc-section-number">9.9</span>  Extensions</a></li>
  <li><a href="#further-reading" id="toc-further-reading" class="nav-link" data-scroll-target="#further-reading"><span class="toc-section-number">9.10</span>  Further Reading</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title d-none d-lg-block"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Nonparametrics I: Distribution and Density Estimation</span></h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
    
  </div>
  

</header>

<div class="cell" data-hash="nonpar_cache/html/unnamed-chunk-1_222a643871897dbbdfa707a65b04d8b6">

</div>
<p>Perhaps one of the most fundamental questions one can ask given observations of a random variable is “what distribution did these come from?” This section aims to answer this question under only one major assumption – the observed data is an IID sample.</p>
<div id="def-" class="theorem definition">
<p><span class="theorem-title"><strong>Definition 9.1 </strong></span>Define the <span style="color:red"><strong><em>IID model</em></strong></span> as <span class="math display">\[\mathcal P_\text{IID} = \left\{F_{\mathbf{X}_1,\ldots,\mathbf{X}_n} \mid F_{\mathbf{X}_1,\ldots,\mathbf{X}_n}\text{ is a valid distribution and } \mathbf{X}_i = \mathbf{X}_j\  \forall i\neq j \right\},\]</span> or <span class="math display">\[\mathcal P_\text{IID} = \left\{f_{\mathbf{X}_1,\ldots,\mathbf{X}_n} \mid f_{\mathbf{X}_1,\ldots,\mathbf{X}_n}\text{ is a valid density and } \mathbf{X}_i = \mathbf{X}_j\  \forall i\neq j \right\}.\]</span> The model is parameterized by the common marginal distribution/density which we will write at <span class="math inline">\(F_{\mathbf{X}}\)</span> and <span class="math inline">\(f_{\mathbf{X}}\)</span>.</p>
</div>
<p>Things get a bit annoying with notation as a result of models (roughly speaking) being the joint distribution of a sample. We’re interested in a situation where we observe <span class="math inline">\(n\)</span> values of some random vector <span class="math inline">\(\mathbf{X}\)</span> and want to estimate <span class="math inline">\(F_\mathbf{X}\)</span> and/or <span class="math inline">\(f_\mathbf{X}\)</span>. This sample is a collection of identical random vectors <span class="math inline">\((\mathbf{X}_1,\ldots,\mathbf{X}_n)\)</span>, so the model is technically the collection of these joint distributions / densities. Of course, because <span class="math inline">\((\mathbf{X}_1,\ldots,\mathbf{X}_n)\)</span> are identically distributed, considering the joint density is moot, and the model is identified by parameterizing it by the distribution / density of <span class="math inline">\(\mathbf{X}\)</span>. As such, we want to develop estimators <span class="math inline">\(\hat F_{\mathbf{X}}(\mathbf{x})\)</span> and <span class="math inline">\(\hat{f}_\mathbf{X}(\mathbf{x})\)</span>. The novelty of this task comes from the fact that the parameter space, which is the set of all probability distributions or probability densities,<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> has infinite dimension. This makes our model nonparametric.</p>
<p>For most of the section, we’ll handle the simple case of estimating the distribution and density of a random scalar <span class="math inline">\(X\)</span>, whose sample is the joint random vector <span class="math inline">\(\mathbf{X}= (X_1, \ldots, X_n)\)</span>. For many of the examples, we’ll simulate our data from a specific distribution that is sufficiently “weird” enough to give a sense for how estimators behave in the absence of “nice” distributions like the standard normal. This specific distribution will be mixed normal distribution that is defined in the following example.</p>
<div id="exm-" class="theorem example">
<p><span class="theorem-title"><strong>Example 9.1 (Mixed Normal Distribution) </strong></span>Suppose we have <span class="math inline">\(L\)</span> random variables <span class="math inline">\(X_\ell\)</span>. We can define a new random variable <span class="math inline">\(X\)</span> by defining <span class="math inline">\(f_X\)</span> to be a convex combination of each density <span class="math inline">\(f_{X_\ell}\)</span>, in effect “mixing” <span class="math inline">\(X_\ell\)</span>. For each <span class="math inline">\(\ell\)</span>, define a mixing probability <span class="math inline">\(p_\ell\)</span> such that <span class="math inline">\(\sum_\ell p_\ell = 1\)</span>. Taking the linear combination of each density <span class="math inline">\(f_{X_\ell}\)</span> with these weights gives <span class="math display">\[ f_X(x) = \sum_{\ell=1}^Lp_\ell f_{X_\ell}(x).\]</span> This process gives a random variable <span class="math inline">\(X\)</span> with the following interpretation – with probability <span class="math inline">\(p_\ell\)</span>, <span class="math inline">\(X = X_\ell\)</span>.<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> The distribution function of <span class="math inline">\(X\)</span> is given by the analagous convex combination of distributions <span class="math inline">\(F_X\)</span>, as differentiation and integration are linear operations.</p>
<p><span class="math display">\[F_X(x) = \sum_{\ell=1}^Lp_\ell F_{X_\ell}(x)\]</span></p>
<p>Suppose we have four normally distributed random variables: <span class="math display">\[\begin{align*}
X_1 &amp; \sim N(0, (0.2)^2),\\
X_2 &amp; \sim N(1.5, (0.5)^2),\\
X_3 &amp; \sim N(4.1, (0.8)^2),\\
X_4 &amp; \sim N(8, (1.5)^2).
\end{align*}\]</span> Define <span class="math inline">\(X\)</span> to be the mixture of these variables, where the mixing weights are all set to <span class="math inline">\(1/4\)</span>. Let’s define functions which give <span class="math inline">\(F_X\)</span> and <span class="math inline">\(f_X\)</span>, along with one that draws random values of <span class="math inline">\(X\)</span>.</p>
<div class="cell" data-hash="nonpar_cache/html/unnamed-chunk-2_c1b85216eada95d372b988de97e5f4c4">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>F_X <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="fl">0.25</span><span class="sc">*</span><span class="fu">pnorm</span>(x, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="fl">0.2</span>) <span class="sc">+</span> </span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="fl">0.25</span><span class="sc">*</span><span class="fu">pnorm</span>(x, <span class="at">mean =</span> <span class="fl">1.5</span>, <span class="at">sd =</span> <span class="fl">0.5</span>) <span class="sc">+</span> </span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="fl">0.25</span><span class="sc">*</span><span class="fu">pnorm</span>(x, <span class="at">mean =</span> <span class="fl">4.1</span>, <span class="at">sd =</span> <span class="fl">0.8</span>) <span class="sc">+</span> </span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="fl">0.25</span><span class="sc">*</span><span class="fu">pnorm</span>(x, <span class="at">mean =</span> <span class="dv">8</span>, <span class="at">sd =</span> <span class="fl">1.5</span>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>f_X <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  <span class="fl">0.25</span><span class="sc">*</span><span class="fu">dnorm</span>(x, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  <span class="fl">0.25</span><span class="sc">*</span><span class="fu">dnorm</span>(x, <span class="at">mean =</span> <span class="fl">1.5</span>, <span class="at">sd =</span> <span class="fl">0.5</span>) <span class="sc">+</span> </span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>  <span class="fl">0.25</span><span class="sc">*</span><span class="fu">dnorm</span>(x, <span class="at">mean =</span> <span class="fl">4.1</span>, <span class="at">sd =</span> <span class="fl">0.8</span>) <span class="sc">+</span> </span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  <span class="fl">0.25</span><span class="sc">*</span><span class="fu">dnorm</span>(x, <span class="at">mean =</span> <span class="dv">8</span>, <span class="at">sd =</span> <span class="fl">1.5</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>draw_X <span class="ot">&lt;-</span> <span class="cf">function</span>(n){</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># make n draws from (1,2,3,4) with equal probability</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>  index <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>), n, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>  (index <span class="sc">==</span> <span class="dv">1</span>)<span class="sc">*</span><span class="fu">rnorm</span>(n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="fl">0.2</span>)  <span class="sc">+</span> </span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>  (index <span class="sc">==</span> <span class="dv">2</span>)<span class="sc">*</span><span class="fu">rnorm</span>(n, <span class="at">mean =</span> <span class="fl">1.5</span>, <span class="at">sd =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>  (index <span class="sc">==</span> <span class="dv">3</span>)<span class="sc">*</span><span class="fu">rnorm</span>(n, <span class="at">mean =</span> <span class="fl">4.1</span>, <span class="at">sd =</span> <span class="fl">0.8</span>) <span class="sc">+</span> </span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>  (index <span class="sc">==</span> <span class="dv">4</span>)<span class="sc">*</span><span class="fu">rnorm</span>(n, <span class="at">mean =</span> <span class="dv">8</span>, <span class="at">sd =</span> <span class="fl">1.5</span>)</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To get a better sense of <span class="math inline">\(X\)</span>, let’s look at it’s distribution and density.</p>
<div class="cell" data-layout-align="center" data-fig.asp="0.7" data-hash="nonpar_cache/html/fig-plot412e1_5caa1db1fdca225f5f3e2594e45f3e0a">
<details>
<summary>Show code which generates figure</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">expand_grid</span>(<span class="at">x =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">12</span>, <span class="at">length =</span> <span class="fl">1e5</span>), <span class="at">func =</span> <span class="fu">c</span>(<span class="st">"Density"</span>, <span class="st">"Distribution"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">X1 =</span> <span class="fu">ifelse</span>(func <span class="sc">==</span> <span class="st">"Density"</span>, <span class="fu">dnorm</span>(x, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="fl">0.2</span>), <span class="fu">pnorm</span>(x, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="fl">0.2</span>)),</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">X2 =</span> <span class="fu">ifelse</span>(func <span class="sc">==</span> <span class="st">"Density"</span>, <span class="fu">dnorm</span>(x, <span class="at">mean =</span> <span class="fl">1.5</span>, <span class="at">sd =</span> <span class="fl">0.5</span>), <span class="fu">pnorm</span>(x, <span class="at">mean =</span> <span class="fl">1.5</span>, <span class="at">sd =</span> <span class="fl">0.5</span>)),</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">X3 =</span> <span class="fu">ifelse</span>(func <span class="sc">==</span> <span class="st">"Density"</span>, <span class="fu">dnorm</span>(x, <span class="at">mean =</span> <span class="fl">4.1</span>, <span class="at">sd =</span> <span class="fl">0.8</span>), <span class="fu">pnorm</span>(x, <span class="at">mean =</span> <span class="fl">4.1</span>, <span class="at">sd =</span> <span class="fl">0.8</span>)),</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">X4 =</span> <span class="fu">ifelse</span>(func <span class="sc">==</span> <span class="st">"Density"</span>, <span class="fu">dnorm</span>(x, <span class="at">mean =</span> <span class="dv">8</span>, <span class="at">sd =</span> <span class="fl">1.5</span>), <span class="fu">pnorm</span>(x, <span class="at">mean =</span> <span class="dv">8</span>, <span class="at">sd =</span> <span class="fl">1.5</span>)),</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">X =</span> <span class="fu">ifelse</span>(func <span class="sc">==</span> <span class="st">"Density"</span>, <span class="fu">f_X</span>(x), <span class="fu">F_X</span>(x))</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gather</span>(<span class="st">"RV"</span>, <span class="st">"val"</span>, <span class="sc">-</span>x, <span class="sc">-</span>func) <span class="sc">%&gt;%</span> </span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">group =</span> <span class="fu">ifelse</span>(RV <span class="sc">==</span> <span class="st">"X"</span>, <span class="st">"Mixture"</span>, <span class="st">"Indiviudal"</span>))  <span class="sc">%&gt;%</span> </span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(x, val, <span class="at">color =</span> RV)) <span class="sc">+</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"black"</span>, <span class="st">"red"</span>, <span class="st">"blue"</span>, <span class="st">"green"</span>, <span class="st">"orange"</span>)) <span class="sc">+</span> </span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="at">rows =</span> <span class="fu">vars</span>(group), <span class="at">cols =</span> <span class="fu">vars</span>(func), <span class="at">scales =</span> <span class="st">"free"</span>, <span class="at">switch =</span> <span class="st">"y"</span>) <span class="sc">+</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-plot412e1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="nonpar_files/figure-html/fig-plot412e1-1.png" class="img-fluid figure-img" width="768"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;9.1: <strong>?(caption)</strong></figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Later on, we’ll also be interested in the derivatives of the density <span class="math inline">\(f_X\)</span>. For any normally distributed random variable <span class="math inline">\(Y\)</span>, the first two derivatives of <span class="math inline">\(f_Y\)</span> are: <span class="math display">\[\begin{align*}
f_Y'(y) &amp; = -\frac{y-\mu}{\sigma^2}f_Y(y), \\
f_Y''(y) &amp; =  \left(\frac{(y-\mu)^2}{\sigma^4} -\frac{1}{\sigma^2}\right) f_Y(y).
\end{align*}\]</span> The density <span class="math inline">\(f_X\)</span> is just a linear combination of various normal densities, so it’s derivatives are the linear combinations of the corresponding derivatives.</p>
<div class="cell" data-hash="nonpar_cache/html/unnamed-chunk-4_c4e7c56dc1dfc638c346264ec8877a15">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>df_dx <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="sc">-</span> ((x<span class="dv">-0</span>)<span class="sc">/</span><span class="fl">0.2</span><span class="sc">^</span><span class="dv">2</span>)<span class="sc">*</span><span class="fl">0.25</span><span class="sc">*</span><span class="fu">dnorm</span>(x, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="fl">0.2</span>) <span class="sc">-</span> </span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  ((x<span class="fl">-1.5</span>)<span class="sc">/</span><span class="fl">0.5</span><span class="sc">^</span><span class="dv">2</span>)<span class="sc">*</span><span class="fl">0.25</span><span class="sc">*</span><span class="fu">dnorm</span>(x, <span class="at">mean =</span> <span class="fl">1.5</span>, <span class="at">sd =</span> <span class="fl">0.5</span>) <span class="sc">-</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  ((x<span class="fl">-4.1</span>)<span class="sc">/</span><span class="fl">0.8</span><span class="sc">^</span><span class="dv">2</span>)<span class="sc">*</span><span class="fl">0.25</span><span class="sc">*</span><span class="fu">dnorm</span>(x, <span class="at">mean =</span> <span class="fl">4.1</span>, <span class="at">sd =</span> <span class="fl">0.8</span>) <span class="sc">-</span> </span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  ((x<span class="dv">-8</span>)<span class="sc">/</span><span class="fl">1.5</span><span class="sc">^</span><span class="dv">2</span>)<span class="sc">*</span><span class="fl">0.25</span><span class="sc">*</span><span class="fu">dnorm</span>(x, <span class="at">mean =</span> <span class="dv">8</span>, <span class="at">sd =</span> <span class="fl">1.5</span>)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>df2_dx2 <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  ((x<span class="dv">-0</span>)<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span><span class="fl">0.2</span><span class="sc">^</span><span class="dv">4</span> <span class="sc">-</span> <span class="dv">1</span><span class="sc">/</span><span class="fl">0.2</span><span class="sc">^</span><span class="dv">2</span>)<span class="sc">*</span><span class="fl">0.25</span><span class="sc">*</span><span class="fu">dnorm</span>(x, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  ((x<span class="fl">-1.5</span>)<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span><span class="fl">0.5</span><span class="sc">^</span><span class="dv">4</span> <span class="sc">-</span> <span class="dv">1</span><span class="sc">/</span><span class="fl">0.5</span><span class="sc">^</span><span class="dv">2</span>)<span class="sc">*</span> <span class="fl">0.25</span><span class="sc">*</span><span class="fu">dnorm</span>(x, <span class="at">mean =</span> <span class="fl">1.5</span>, <span class="at">sd =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  ((x<span class="fl">-4.1</span>)<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span><span class="fl">0.8</span><span class="sc">^</span><span class="dv">4</span> <span class="sc">-</span> <span class="dv">1</span><span class="sc">/</span><span class="fl">0.8</span><span class="sc">^</span><span class="dv">2</span>)<span class="sc">*</span><span class="fl">0.25</span><span class="sc">*</span><span class="fu">dnorm</span>(x, <span class="at">mean =</span> <span class="fl">4.1</span>, <span class="at">sd =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  ((x<span class="dv">-8</span>)<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span><span class="fl">1.5</span><span class="sc">^</span><span class="dv">4</span> <span class="sc">-</span> <span class="dv">1</span><span class="sc">/</span><span class="fl">1.5</span><span class="sc">^</span><span class="dv">2</span>)<span class="sc">*</span><span class="fl">0.25</span><span class="sc">*</span><span class="fu">dnorm</span>(x, <span class="at">mean =</span> <span class="dv">8</span>, <span class="at">sd =</span> <span class="fl">1.5</span>)</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>} </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center" data-fig.asp="0.7" data-hash="nonpar_cache/html/fig-plot412e17_77dd19464059523335656f8a0c776058">
<details>
<summary>Show code which generates figure</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">12</span>, <span class="at">length =</span> <span class="fl">1e5</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">Density =</span> <span class="fu">f_X</span>(x),</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">First Derivative</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">df_dx</span>(x),</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Second Derivative</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">df2_dx2</span>(x)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gather</span>(<span class="st">"func"</span>, <span class="st">"value"</span>, <span class="sc">-</span>x) <span class="sc">%&gt;%</span> </span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(x, value)) <span class="sc">+</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>func, <span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-plot412e17" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="nonpar_files/figure-html/fig-plot412e17-1.png" class="img-fluid figure-img" width="768"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;9.2: <strong>?(caption)</strong></figcaption><p></p>
</figure>
</div>
</div>
</div>
</div>
<section id="math-preliminaries" class="level2" data-number="9.1">
<h2 data-number="9.1" class="anchored" data-anchor-id="math-preliminaries"><span class="header-section-number">9.1</span> Math Preliminaries</h2>
<p>Until now, we’ve be focused on estimating parametric models, i.e models where parameters had finite dimension. Even more precisely, all the the estimands up until this point have been elements of <span class="math inline">\(\mathbb{R}^n\)</span>, a space we’re familiar with. Now that we’re concerned with estimating a probability density <span class="math inline">\(f,\)</span> we’re estimating entire functions that belong to spaces of functions with infinite dimension. This will require the introduction of some light functional analysis. Some of this discussion will be similar to that in <a href="ols.html#sec-proj"><span>Section&nbsp;5.15</span></a>.</p>
<p>The space <span class="math inline">\(\mathbb{R}^k\)</span> is a <em>normed vector space</em> equipped with, as the name implies, a special function called a <em>norm</em> which measures a vector’s distance from the origin. In the case of <span class="math inline">\(\mathbb{R}^k\)</span>, this norm is usually given as <span class="math display">\[ \left\lVert\mathbf{x}\right\rVert_2 = \left(\sum_{i=1}^n x_i^2\right)^{1/2},\]</span> and is called the <em>Euclidean norm</em>. Any norm can be used to define a metric (a function which measures the distance between two vectors), and in the case of <span class="math inline">\(\mathbb{R}^k\)</span> we have <span class="math display">\[ \left\lVert\mathbf{x}-\mathbf{y}\right\rVert_2 = \left(\sum_{i=1}^n (x_i-y_i)^2\right)^{1/2}.\]</span> All we’ve done is introduce some definitions and notation to the familiar formula used to measure the distance between two points in Euclidean space. In general we can define the <span class="math inline">\(p\)</span>-norm on <span class="math inline">\(\mathbb{R}^k\)</span> as <span class="math display">\[ \left\lVert\mathbf{x}\right\rVert_p = \left(\sum_{i=1}^n \left\lvert x_i\right\rvert^p\right)^{1/p}.\]</span> If we let <span class="math inline">\(p = 2\)</span>, we end up with the Euclidean norm. Why bother considering other values of <span class="math inline">\(p\)</span>? We can think of <span class="math inline">\(p\)</span> as the way we weight the component-wise “distances” from the origin <span class="math inline">\(\left\lvert x_1\right\rvert,\left\lvert x_2\right\rvert,\ldots \left\lvert x_k\right\rvert\)</span>. For <span class="math inline">\(p = 2\)</span>, we square each of these distances (meaning the result is always positive rendering the absolute value moot), assigning more weight to components where <span class="math inline">\(x_i\)</span> is relatively large.</p>
<div id="exm-" class="theorem example">
<p><span class="theorem-title"><strong>Example 9.2 (p = 1) </strong></span>If we let <span class="math inline">\(p = 1\)</span>, the <span class="math inline">\(p\)</span>-norm simplifies to</p>
<p><span class="math display">\[\left\lVert\mathbf{x}\right\rVert_1 = \sum_{i=1}^n \left\lvert x_i\right\rvert.\]</span></p>
<p>This norm induces the “taxi-cab metric”,</p>
<p><span class="math display">\[\left\lVert\mathbf{x}- \mathbf{y}\right\rVert_1 = \sum_{i=1}^n \left\lvert x_i - y_i\right\rvert,\]</span> whose name follows from how you would define distance if you were driving between two points in a city with a grid layout.</p>
</div>
<div id="exm-" class="theorem example">
<p><span class="theorem-title"><strong>Example 9.3 (Increasing p) </strong></span>What happens if we let <span class="math inline">\(p\)</span> get arbitrarily large? Let’s plot <span class="math inline">\(\left\lVert\mathbf{x}\right\rVert_p\)</span> for various values of <span class="math inline">\(\mathbf{x}\)</span>.</p>
<div class="cell" data-layout-align="center" data-fig.asp="1" data-hash="nonpar_cache/html/unnamed-chunk-6_afd29b3fbd22a9c530b7eab5c44b7fb8">
<details>
<summary>Show code which generates figure</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>p_norm <span class="ot">&lt;-</span> <span class="cf">function</span>(p, x){</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  (<span class="fu">sum</span>(<span class="fu">abs</span>(x)<span class="sc">^</span>p))<span class="sc">^</span>(<span class="dv">1</span><span class="sc">/</span>p)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">x1 =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">x2 =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>),</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">x3 =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">3</span>, <span class="dv">3</span>),</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">x4 =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="sc">-</span><span class="dv">4</span>)</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>       ) <span class="sc">%&gt;%</span> </span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">vector =</span> <span class="fu">ifelse</span>(x4 <span class="sc">==</span> <span class="sc">-</span><span class="dv">4</span>, <span class="st">"x = (1,2,3,-4)"</span>, <span class="fu">ifelse</span>(x3 <span class="sc">==</span> <span class="dv">3</span>, <span class="st">"x = (1,2,3)"</span>, <span class="fu">ifelse</span>(x2 <span class="sc">==</span> <span class="dv">2</span>, <span class="st">"x = (1,2)"</span>, <span class="st">"x = 1"</span>))))  <span class="sc">%&gt;%</span> </span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand_grid</span>(<span class="at">p =</span> <span class="fu">seq</span>(<span class="dv">1</span>,<span class="dv">10</span>, <span class="at">length =</span> <span class="dv">100</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">norm =</span> <span class="fu">p_norm</span>(p, <span class="fu">c</span>(x1, x2, x3, x4))) <span class="sc">%&gt;%</span> </span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(p, norm)) <span class="sc">+</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span> </span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>vector, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"p"</span>, <span class="at">y =</span> <span class="st">"p-norm"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="nonpar_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="1056"></p>
<p></p><figcaption class="figure-caption">Distribution of estimators for the population variance</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>An interesting pattern comes to light – it appears that as <span class="math inline">\(p \to \infty\)</span>, <span class="math inline">\(\left\lVert\mathbf{x}\right\rVert_p\)</span> approaches the largest possible value of <span class="math inline">\(\left\lvert x_i\right\rvert\)</span>.</p>
</div>
<p>As this example hints at, <span class="math display">\[\left\lVert\mathbf{x}\right\rVert_{\infty} = \max_{x_i}\left\lvert x_i\right\rvert.\]</span> As we let <span class="math inline">\(p\to\infty\)</span>, we put increasingly more weight on the components <span class="math inline">\(x_i\)</span> which have the largest distance from <span class="math inline">\(0\)</span> in their dimension. Eventually, <span class="math inline">\(p\)</span> becomes so large that the contribution of <span class="math inline">\(\left(\max_{x_i}\left\lvert x_i\right\rvert\right)^p\)</span> to the sum dwarfs those of the other components, and we end up with something which is practically <span class="math inline">\(\max_{x_i}\left\lvert x_i\right\rvert\)</span> after taking the <span class="math inline">\(p\)</span>-th root of the sum. The result of this limiting process gives <span class="math inline">\(\left\lVert\mathbf{x}\right\rVert_\infty\)</span>. An excellent way to illustrate this is by graphing the set <span class="math inline">\(\{\mathbf{x}\in \mathbb{R}^2 \mid \left\lVert\mathbf{x}\right\rVert_p = 1\}\)</span>, i.e the boundary of the unit ball in <span class="math inline">\(\mathbb{R}^2\)</span> equipped with <span class="math inline">\(\left\lVert\cdot\right\rVert_p\)</span>.</p>
<div class="cell" data-layout-align="center" data-fig.asp="0.5" data-hash="nonpar_cache/html/fig-plot531243_f1cd75e6a0336d006cd2bf3e0f19112d">
<div class="cell-output-display">
<div id="fig-plot531243" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="figures/lp_norm.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;9.3: test</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>So what does this all have to do with statistics and econometrics? Quite a bit if you consider the important role loss functions play in estimation. For a scalar estimator <span class="math inline">\(\hat \theta\)</span>, the quadratic loss function <span class="math inline">\(l(\hat\theta,\theta) = (\hat\theta - \theta)^2\)</span> gave the special risk function known as mean square error. <span class="math display">\[ \text{MSE}\left(\hat \theta \right)= \text{E}\left[(\hat\theta - \theta)^2\right].\]</span></p>
<p>If <span class="math inline">\(\hat{\boldsymbol{\theta}}\)</span> is a vector, then we can write <span class="math inline">\(\text{MSE}\left(\hat{\boldsymbol{\theta}}\right)\)</span> in terms of <span class="math inline">\(\left\lVert\cdot\right\rVert_2\)</span>.</p>
<p><span class="math display">\[\text{MSE}\left(\hat{ \boldsymbol{\theta}} \right)= \text{E}\left[\textstyle\sum_{i=1}^n(\hat\theta_i - \theta_i)^2\right] = \text{E}\left[\left\lVert\hat{\boldsymbol{\theta}} - \boldsymbol{\theta}\right\rVert_2^2\right].\]</span></p>
<p>In general, you’re welcome to define a risk function using the <span class="math inline">\(p\)</span>-norm for any value of <span class="math inline">\(p\)</span>, and there may be situations which call for this depending on which components of <span class="math inline">\(\hat{\boldsymbol{\theta}}\)</span> are deemed important.</p>
<p><span class="math display">\[R(\hat{\boldsymbol{\theta}}, \boldsymbol{\theta}) = \text{E}\left[\left\lVert\hat{\boldsymbol{\theta}} - \boldsymbol{\theta}\right\rVert_p^p\right]\]</span></p>
<p>Now we’re ready to extend this to vector spaces of functions. Suppose <span class="math inline">\(\mathcal F\)</span> is a vector space of real valued functions <span class="math inline">\(f:\mathbb{R}^n\to\mathbb{R}\)</span>. For the sake of ease, let’s also assume all of these functions are continuous and bounded. In this case, <span class="math inline">\(f\)</span> is defined at an uncountably infinite number of points, so we cannot possibly sum over values of <span class="math inline">\(\left\lvert f(\mathbf{x})\right\rvert^p\)</span> for all <span class="math inline">\(\mathbf{x}\in\mathbb{R}\)</span>. Instead we’ll have to integrate over <span class="math inline">\(\mathbf{x}\)</span>. This gives</p>
<p><span class="math display">\[\left\lVert f\right\rVert_p =\left(\int_{-\infty}^\infty \left\lvert f(\mathbf{x})\right\rvert^p\ d\mathbf{x}\right)^{1/p}.\]</span></p>
<p>Just like in the case of Euclidean space, the <span class="math inline">\(p-\)</span>norm also endows <span class="math inline">\(\mathcal F\)</span> with a metric that measures the distance between two functions which belong to <span class="math inline">\(\mathcal F\)</span>. <span class="math display">\[ \left\lVert f - g\right\rVert_p =\left(\int_{-\infty}^\infty \left\lvert f(\mathbf{x}) - g(\mathbf{x})\right\rvert^p\ d\mathbf{x}\right)^{1/p}\]</span> For <span class="math inline">\(f\in \mathcal F\)</span> we have <span class="math display">\[ \left\lVert f\right\rVert_\infty = \sup_{\mathbf{x}\in \mathbb{R}^n}\left\lvert f(\mathbf{x})\right\rvert,\]</span> where we take the supremum instead of maximum to account for the possibility that as <span class="math inline">\(p\to\infty\)</span> <span class="math inline">\(\max_{\mathbf{x}\in \mathbb{R}^n}\left\lvert f(\mathbf{x})\right\rvert\)</span> may approach a limit whose value it never takes on. This norm is particularly important because the role it plays in the convergence of sequences of functions. If we have a sequence of functions <span class="math inline">\(f_n\)</span>, then <span class="math inline">\(f_n\)</span> converges to <span class="math inline">\(f\)</span> uniformly if and only if <span class="math display">\[ \lim_{n\to\infty}\left\lVert f_n - f\right\rVert_\infty = 0.\]</span> For this reason, the supremum norm is also known as the “uniform norm”.</p>
<p>All of this can be defined for general vector spaces of functions, and not just the space of real valued functions which are bounded and continuous. It’s also possible to unify the separate discussions of <span class="math inline">\(\left\lVert\cdot\right\rVert_p\)</span> on Euclidean space and <span class="math inline">\(\left\lVert\cdot\right\rVert_p\)</span> on function spaces using a bit of measure theory.<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a></p>
</section>
<section id="estimating-a-distribution" class="level2" data-number="9.2">
<h2 data-number="9.2" class="anchored" data-anchor-id="estimating-a-distribution"><span class="header-section-number">9.2</span> Estimating a Distribution</h2>
<p>We’ll start with the task of developing an estimator <span class="math inline">\(\hat F_X\)</span> for a random variable’s distribution function <span class="math inline">\(X\)</span>. The distribution <span class="math inline">\(F_X\)</span> is defined as <span class="math display">\[F_X(t) = \Pr(X \le t),\]</span> so all we are doing is estimating a probability for all possible values of <span class="math inline">\(x \in \mathcal X\)</span>. If that sounds easy, it’s because it is. We can just look at the proportion of observations which are less than or equal to <span class="math inline">\(t,\)</span> and take this to be <span class="math inline">\(\Pr(X \le t)\)</span>.</p>
<p><span class="math display">\[\hat F_X(t) = \frac{\text{number of observations} \le t}{\text{number of observations}}.\]</span></p>
<div id="def-" class="theorem definition">
<p><span class="theorem-title"><strong>Definition 9.2 </strong></span>Given an IID sample of size <span class="math inline">\(n\)</span> of a random variable <span class="math inline">\(X\)</span>, the <span style="color:red"><strong><em>empirical (cumulative) distribution function (eCDF)</em></strong></span> is defined as <span class="math display">\[\hat F_X(t) = \frac{1}{n}\sum_{i=1}^n I\left[X_i \le t\right].\]</span></p>
</div>
<div id="exm-" class="theorem example">
<p><span class="theorem-title"><strong>Example 9.4 </strong></span>Let’s calculate <span class="math inline">\(\hat F_X\)</span> for our mixed normal distribution using a sample of size <span class="math inline">\(n = 100\)</span>.</p>
<div class="cell" data-hash="nonpar_cache/html/unnamed-chunk-8_bf3ee1934d4bba1e88c16b4cce3639a3">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>emp_dist <span class="ot">&lt;-</span> <span class="cf">function</span>(sample, t){</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">length</span>(sample)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sum</span>(sample <span class="sc">&lt;=</span> t)<span class="sc">/</span>n</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">draw_X</span>(n)</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate the estimate by calculating values on approximate support </span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>F_hat <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="fu">seq</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">12</span>, <span class="at">length =</span> <span class="fl">1e5</span>), emp_dist, <span class="at">sample =</span> X)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now let’s plot the estimated distribution and contrast it with the versus the true distribution.</p>
<div class="cell" data-layout-align="center" data-fig.asp="0.7" data-hash="nonpar_cache/html/fig-plot412e1712_7687c4dc34c5cad7962d54d9f8337cca">
<details>
<summary>Show code which generates figure</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">12</span>, <span class="at">length =</span> <span class="fl">1e5</span>), <span class="st">`</span><span class="at">Empirical Distribution</span><span class="st">`</span> <span class="ot">=</span> F_hat) <span class="sc">%&gt;%</span> </span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">True Distribution</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">F_X</span>(x)) <span class="sc">%&gt;%</span> </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gather</span>(<span class="st">"func"</span>, <span class="st">"prob"</span>, <span class="sc">-</span>x) <span class="sc">%&gt;%</span> </span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(x, prob, <span class="at">color =</span> func)) <span class="sc">+</span> </span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"black"</span>, <span class="st">"red"</span>)) <span class="sc">+</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"t"</span>, <span class="at">color =</span> <span class="st">""</span>, <span class="at">y =</span> <span class="st">"Pr(X &lt;= t)"</span>)  <span class="sc">+</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-plot412e1712" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="nonpar_files/figure-html/fig-plot412e1712-1.png" class="img-fluid figure-img" width="768"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;9.4: <strong>?(caption)</strong></figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>By construction, <span class="math inline">\(\hat F_X(x)\)</span> is a discontinuous step function because it is the sum of discontinuous indicator functions. Nevertheless, <span class="math inline">\(\hat F_X\)</span> looks pretty close to <span class="math inline">\(F_X\)</span>!</p>
</div>
</section>
<section id="properties-of-the-empirical-distribution" class="level2" data-number="9.3">
<h2 data-number="9.3" class="anchored" data-anchor-id="properties-of-the-empirical-distribution"><span class="header-section-number">9.3</span> Properties of the Empirical Distribution</h2>
<section id="pointwise-properties" class="level3" data-number="9.3.1">
<h3 data-number="9.3.1" class="anchored" data-anchor-id="pointwise-properties"><span class="header-section-number">9.3.1</span> Pointwise Properties</h3>
<p>The challenge of determining the properties of <span class="math inline">\(\hat F_X\)</span> comes from it being an entire function opposed to a single value. Let’s start with an easier task by reframing the problem to consider <span class="math inline">\(\hat F_X\)</span> <em>evaluated</em> at some fixed point <span class="math inline">\(x_0\)</span>. That is, what are the <em>pointwise</em> properties of <span class="math inline">\(\hat F_X(x_0)\)</span>?</p>
<p>First, let’s consider the bias of <span class="math inline">\(\hat F_X(x_0)\)</span>. The empirical distribution function is a linear combination of indicator functions, so taking its expectation is straightforward. <span class="math display">\[\begin{align*}
\text{E}\left[\hat F_X(x_0)\right] &amp; = \text{E}\left[\frac{1}{n}\sum_{i=1}^n I\left[X_i \le x_0\right]\right]\\
&amp; = \frac{1}{n}\sum_{i=1}^n \text{E}\left[I\left[X_i \le x_0\right]\right]\\
&amp; = \frac{1}{n}\sum_{i=1}^n 1\cdot \Pr(X_i \le x_0) + 0\cdot \Pr(X_i &gt; x_0) &amp; (\text{definition of indicator})\\
&amp; = \frac{1}{n}\left(n\cdot  \Pr(X_i \le x_0)\right)\\
&amp; =  \Pr(X_i \le x_0)\\
&amp; = F_X(x_0)
\end{align*}\]</span> The estimator, as perhaps anticipated, is unbiased. Now let’s calculate its variance. <span class="math display">\[\begin{align*}
\text{Var}\left(\hat F_X(x_0)\right) &amp; = \text{Var}\left(\frac{1}{n}\sum_{i=1}^n I\left[X_i \le x_0\right]\right)\\
&amp; = \frac{1}{n^2} \sum_{i=1}^n \left\{\text{E}\left[I\left[X_i \le x_0\right]^2\right] - \left(\text{E}\left[I\left[X_i \le x_0\right]\right]\right)^2\right\}\\
&amp; = \frac{1}{n^2} \sum_{i=1}^n \left\{\text{E}\left[I\left[X_i \le x_0\right]\right] - \left(\text{E}\left[I\left[X_i \le x_0\right]\right]\right)^2\right\} &amp; (I\left[X_i \le x_0\right]^2 = I\left[X_i \le x_0\right])\\
&amp; = \frac{1}{n^2} \sum_{i=1}^n \left[\Pr(X_i \le x_0) - \Pr(X_i \le x_0)^2\right] &amp; (\text{E}\left[I\left[X_i \le x_0\right]\right] = \Pr(X_i \le x_0))\\
&amp; = \frac{1}{n^2}[n\Pr(X_i \le x_0)(1- \Pr(X_i \le x_0))]\\
&amp; = \frac{F_X(x_0)(1-F_X(x_0))}{n}
\end{align*}\]</span> If calculating the expectation and variance of <span class="math inline">\(\hat F_X(x_0)\)</span> feels “familiar”, that may be because we’ve just calculated the expected value and variance of a binomial random variable. Define <span class="math inline">\(Y = n\hat F_X(x)\)</span> such that <span class="math display">\[ Y = \sum_{i=1}^n I\left[X_i \le x_0\right].\]</span> The random variable <span class="math inline">\(Y\)</span> is the sum of <span class="math inline">\(n\)</span> Bernoulli trials, each with succeeding with probability <span class="math inline">\(\Pr(X_i \le x_0) = F_X(x_0)\)</span>, meaning <span class="math inline">\(Y \sim \text{Bernoulli}(n, F_X(x_0))\)</span>. As such, we can just appeal to the expected value and variance of <span class="math inline">\(Y\)</span> to calculate the corresponding moments for <span class="math inline">\(\hat F_X(x)\)</span>. <span class="math display">\[\begin{align*}
\text{E}\left[\hat F_X(x)\right] &amp; = \text{E}\left[\frac{1}{n}Y\right] = \frac{1}{n}\left(nF_X(x_0)\right) = F_X(x_0)\\
\text{Var}\left(\hat F_X(x)\right) &amp; = \text{Var}\left(\frac{1}{n}Y\right) = \frac{1}{n^2}\left(nF_X(x_0)(1-F_X(x_0))\right) = \frac{F_X(x_0)(1-F_X(x_0))}{n}
\end{align*}\]</span></p>
<p>Noting that <span class="math inline">\(\lim_{n\to\infty}\text{Var}\left(\hat F_X(x_0)\right) = 0\)</span>, <a href="asymptotics.html#cor-unbcon">Corollary&nbsp;<span>2.2</span></a> establishes that <span class="math inline">\(\hat F_X(x_0)\)</span> is consistent. <span class="math display">\[ \hat F_X(x_0) \overset{p}{\to}F_X(x_0)\]</span> Finally, because <span class="math inline">\(\hat F_X(x_0)\)</span> is the average of independent Bernoulli trials, so we can apply the CLT to conclude that <span class="math inline">\(\sqrt n[\hat F_X(x_0)- F_X(x_0)] \overset{d}{\to}N(0, F_X(x_0)(1-F_X(x_0)))\)</span>.</p>
<div id="thm-" class="theorem">
<p><span class="theorem-title"><strong>Theorem 9.1 (Pointwise Properties of Empirical Distribution) </strong></span>The empirical distribution function <span class="math inline">\(\hat F_X(x_0)\)</span>, <em>evaluated at a fixed point</em> <span class="math inline">\(x_0\)</span>, exhibits the following properties:</p>
<ol type="1">
<li>Unbiasedness, <span class="math inline">\(\text{E}\left[\hat F_X(x_0)\right] = F_X(x_0)\)</span>;</li>
<li><span class="math inline">\(\text{Var}\left(\hat F_X(x_0)\right) = \frac{F_X(x_0)(1-F_X(x_0))}{n}\)</span>;</li>
<li>Consistency, <span class="math inline">\(\hat F_X(x_0) \overset{p}{\to}F_X(x_0)\)</span>;</li>
<li>Asymptotic Normality, <span class="math inline">\(\hat F_X(x_0) \overset{a}{\sim}N(0, F_X(x_0)(1-F_X(x_0))/n)\)</span>.</li>
</ol>
</div>
<div id="exm-" class="theorem example">
<p><span class="theorem-title"><strong>Example 9.5 </strong></span>To illustrate these properties, let’s simulate the estimation of <span class="math inline">\(F_X(0)\)</span> where <span class="math inline">\(X\)</span> is distributed according to the mixed normal distribution we’ve been using. First, let’s see what the true value of <span class="math inline">\(F_X(X_0)\)</span> is, along with <span class="math inline">\(F_X(X_0)(1-F_X(X_0))/n\)</span>.</p>
<div class="cell" data-hash="nonpar_cache/html/unnamed-chunk-10_ec4d496d018c5bf608d46d9b5ff7668b">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>x_0 <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="fu">F_X</span>(x_0)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.1253375</code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>(<span class="dv">1</span> <span class="sc">-</span> <span class="fu">F_X</span>(x_0))<span class="sc">*</span><span class="fu">F_X</span>(x_0)<span class="sc">/</span>n</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.00109628</code></pre>
</div>
</div>
<p>For our first simulations, we’ll simulate one million estimates using samples of size <span class="math inline">\(n = 1,000\)</span>.</p>
<div class="cell" data-hash="nonpar_cache/html/unnamed-chunk-11_46407204d8e28f0910805c4b284d7aaa">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>N_sim <span class="ot">&lt;-</span> <span class="fl">1e6</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>estimates <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">"numeric"</span>, <span class="at">length =</span> N_sim)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>N_sim) {</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  X <span class="ot">&lt;-</span> <span class="fu">draw_X</span>(n)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  estimates[k] <span class="ot">&lt;-</span> <span class="fu">emp_dist</span>(X, x_0)</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(estimates)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.1253935</code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">var</span>(estimates)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.001099587</code></pre>
</div>
</div>
<p>The simulated expectation and variance are in line with our calculations. Let’s now look at the histogram of our values compared with the theoretical limiting distribution.</p>
<div class="cell" data-layout-align="center" data-fig.asp="0.7" data-hash="nonpar_cache/html/fig-plot412e171212_4b2f5d0cf1c30fee8f40744842413841">
<details>
<summary>Show code which generates figure</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(estimates) <span class="sc">%&gt;%</span> </span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(estimates)) <span class="sc">+</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">y =</span> ..density..), <span class="at">fill =</span> <span class="st">"white"</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">binwidth =</span> .<span class="dv">01</span>) <span class="sc">+</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_function</span>(<span class="at">fun =</span> dnorm, <span class="at">args =</span> <span class="fu">list</span>(<span class="at">mean =</span> <span class="fu">F_X</span>(x_0), <span class="at">sd =</span> <span class="fu">sqrt</span>((<span class="dv">1</span> <span class="sc">-</span> <span class="fu">F_X</span>(x_0))<span class="sc">*</span><span class="fu">F_X</span>(x_0)<span class="sc">/</span>n)), <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Empirical Distribution Evaluated at 0"</span>, <span class="at">y =</span> <span class="st">"Density"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-plot412e171212" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="nonpar_files/figure-html/fig-plot412e171212-1.png" class="img-fluid figure-img" width="768"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;9.5: <strong>?(caption)</strong></figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>A second set of simulations for varying sample sizes can illustrate consistency.</p>
<div class="cell" data-hash="nonpar_cache/html/unnamed-chunk-13_7cef53292a9e1adb2ddbd1757aa6382a">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>N_sim <span class="ot">&lt;-</span> <span class="fl">1e4</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>estimates <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">"numeric"</span>, <span class="at">length =</span> N_sim)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (n <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>N_sim) {</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  X <span class="ot">&lt;-</span> <span class="fu">draw_X</span>(n)</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  estimates[n] <span class="ot">&lt;-</span> <span class="fu">emp_dist</span>(X, x_0) </span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center" data-fig.asp="0.7" data-hash="nonpar_cache/html/fig-plot412e171123_54e2fa1d37010e1006bc2e5cb448d1fc">
<details>
<summary>Show code which generates figure</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">n =</span> <span class="dv">1</span><span class="sc">:</span>N_sim, estimates) <span class="sc">%&gt;%</span> </span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(n, estimates)) <span class="sc">+</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">F_X</span>(x_0), <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Empirical Distribution Evaluated at 0"</span>, <span class="at">x =</span> <span class="st">"Sample Size, n"</span>) <span class="sc">+</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-plot412e171123" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="nonpar_files/figure-html/fig-plot412e171123-1.png" class="img-fluid figure-img" width="768"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;9.6: <strong>?(caption)</strong></figcaption><p></p>
</figure>
</div>
</div>
</div>
</div>
<div id="exm-" class="theorem example">
<p><span class="theorem-title"><strong>Example 9.6 (Confidence Intervals) </strong></span>It’s possible to construct pointwise confidence intervals using the fact that <span class="math inline">\(\hat F_X(x_0) \overset{a}{\sim}N(0, F_X(x_0)(1-F_X(x_0))/n)\)</span>. A level <span class="math inline">\((1-\alpha)\)</span> confidence interval for <span class="math inline">\(F_X(x_0)\)</span> would be given by <span class="math display">\[ \left[\hat F_X(x_0) - \Phi^{-1}(1-\alpha/2)\sqrt{\frac{\hat F_X(x_0)(1-\hat F_X(x_0))}{n}}, \hat F_X(x_0) + \Phi^{-1}(1-\alpha/2)\sqrt{ \frac{\hat F_X(x_0)(1-\hat F_X(x_0))}{n}}\right].\]</span> If we want to construct these intervals for multiple values of <span class="math inline">\(F_X(x_0)\)</span>, we need to be careful because they’re pointwise. For the sake of illustration, let’s construct these confidence intervals (taking <span class="math inline">\(\alpha=0.05\)</span>) over the support of <span class="math inline">\(F_X\)</span> and graph our results.</p>
<div class="cell" data-hash="nonpar_cache/html/unnamed-chunk-15_4387ca754aea10b5151d93c811deefd6">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">draw_X</span>(n)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>CI <span class="ot">&lt;-</span> <span class="cf">function</span>(a, sample, t){</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">length</span>(sample)</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>  F_hat <span class="ot">&lt;-</span> <span class="fu">emp_dist</span>(sample, t)</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>  lower <span class="ot">&lt;-</span> F_hat  <span class="sc">-</span> <span class="fu">qnorm</span>(<span class="dv">1</span> <span class="sc">-</span> a<span class="sc">/</span><span class="dv">2</span>)<span class="sc">*</span><span class="fu">sqrt</span>((F_hat<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>F_hat))<span class="sc">/</span>n)</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>  upper <span class="ot">&lt;-</span> F_hat  <span class="sc">+</span> <span class="fu">qnorm</span>(<span class="dv">1</span> <span class="sc">-</span> a<span class="sc">/</span><span class="dv">2</span>)<span class="sc">*</span><span class="fu">sqrt</span>((F_hat<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>F_hat))<span class="sc">/</span>n)</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">c</span>(lower, upper))</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>F_hat <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="fu">seq</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">12</span>, <span class="at">length =</span> <span class="fl">1e5</span>), emp_dist, <span class="at">sample =</span> X)</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>F_CI <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="fu">seq</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">12</span>, <span class="at">length =</span> <span class="fl">1e5</span>), CI, <span class="at">a =</span> <span class="fl">0.05</span>, <span class="at">sample =</span> X)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s plot our confidence intervals along the support of <span class="math inline">\(F_X\)</span>.</p>
<div class="cell" data-layout-align="center" data-fig.asp="0.7" data-hash="nonpar_cache/html/fig-plot412e17190_42cfee262df8f029dfa250db499aac66">
<details>
<summary>Show code which generates figure</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t</span>(F_CI) <span class="sc">%&gt;%</span> </span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">lower =</span> V1,</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">upper =</span> V2</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">12</span>, <span class="at">length =</span> <span class="fl">1e5</span>),</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">F_hat =</span> F_hat</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(x, F_hat)) <span class="sc">+</span> </span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> <span class="st">"Empirical Distribution"</span>)) <span class="sc">+</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> lower, <span class="at">ymax =</span> upper, <span class="at">fill =</span> <span class="st">"95% (Pointwise) Confidence Interval"</span>), <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"black"</span>)) <span class="sc">+</span></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"black"</span>)) <span class="sc">+</span></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"t"</span>, <span class="at">y =</span> <span class="st">"Pr(X &lt; t)"</span>, <span class="at">color =</span> <span class="st">""</span>, <span class="at">fill =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-plot412e17190" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="nonpar_files/figure-html/fig-plot412e17190-1.png" class="img-fluid figure-img" width="768"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;9.7: <strong>?(caption)</strong></figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>How do we interpret these intervals? <em>For each separate</em> <span class="math inline">\(x_0\)</span> there is a 95% chance our interval contains the true value <span class="math inline">\(F_X(x_0)\)</span>. It is not the case that there is a 95% chance that the entire function <span class="math inline">\(\hat F_X\)</span> is contained in the interval, because we’re not considering the behavior of <span class="math inline">\(\hat F_X\)</span> as a function yet.</p>
</div>
</section>
<section id="empirical-process-theory" class="level3" data-number="9.3.2">
<h3 data-number="9.3.2" class="anchored" data-anchor-id="empirical-process-theory"><span class="header-section-number">9.3.2</span> Empirical Process Theory</h3>
<p>Let’s now change gears and consider the properties of <span class="math inline">\(\hat F_X\)</span> as a function, and not just the properties of <span class="math inline">\(\hat F_X(x_0)\)</span> for some fixed <span class="math inline">\(x_0\)</span>. The study of <span class="math inline">\(\hat F_X\)</span> as an entire function is the subject of <em>empirical process theory</em>, which is a fairly technical branch of asymptotic theory.</p>
<div id="def-" class="theorem definition">
<p><span class="theorem-title"><strong>Definition 9.3 </strong></span>The function <span class="math inline">\(t \mapsto \hat F_X(t)\)</span> is an <span style="color:red"><strong><em>empirical process</em></strong></span>.</p>
</div>
<p>When considering the properties of <span class="math inline">\(\hat F_X\)</span> as an empirical process, we need to think about it as an element of a space of functions. Instead of looking at the discrepancy of <span class="math inline">\(\hat F_X(t) - F_X(t)\)</span> for a fixed <span class="math inline">\(t\)</span>, we will work with <span class="math display">\[\left\lVert\hat F_X - F_X\right\rVert_p = \left(\int_{\mathcal X} \left\lvert\hat F_X(t) - F_X(t)\right\rvert^p\ dt \right)^{1/p}.\]</span> In particular, we’ll focus on the case where <span class="math inline">\(p=\infty\)</span>, <span class="math display">\[\left\lVert\hat F_X - F_X\right\rVert_\infty = \sup_{t\in\mathcal X}\left\lvert\hat F_X(t) - F_X(t)\right\rvert.\]</span> Not only is the supremum norm the conservative choice because it assess <span class="math inline">\(\hat F_X\)</span> at the point where the discrepancy <span class="math inline">\(\left\lvert\hat F_X(t) - F_X(t)\right\rvert\)</span> is the “largest”<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a>, but <span class="math inline">\(\left\lVert\cdot\right\rVert_\infty\)</span> is also used to define uniform convergence.</p>
<p>The first, and perhaps most important, result about <span class="math inline">\(\hat F_X(t)\)</span>’s behavior as a function of <span class="math inline">\(t\)</span> involves consistency. We know that <span class="math inline">\(\hat F_X(t)\overset{p}{\to}F_X(t)\)</span> for each separate <span class="math inline">\(t\)</span>, but does this convergence occur uniformly for all <span class="math inline">\(t\)</span>?</p>
<p>As famously shown by <span class="citation" data-cites="glivenko1933sulla">Glivenko (<a href="references.html#ref-glivenko1933sulla" role="doc-biblioref">1933</a>)</span> and <span class="citation" data-cites="cantelli">Cantelli (<a href="references.html#ref-cantelli" role="doc-biblioref">1933</a>)</span>.</p>
<div id="thm-" class="theorem">
<p><span class="theorem-title"><strong>Theorem 9.2 (Glivenko-Cantelli) </strong></span>If <span class="math inline">\(X_1,\ldots,X_n\)</span> are IID random variables with a distribution <span class="math inline">\(F_X\)</span>, then <span class="math display">\[ \left\lVert\hat F_X - F_X\right\rVert_\infty \overset{p}{\to}0.\]</span></p>
</div>
<div class="proof">
<p><span class="proof-title"><em>Proof</em>. </span>See</p>
</div>
<div id="exm-" class="theorem example">
<p><span class="theorem-title"><strong>Example 9.7 </strong></span>If we take the Glivenko-Cantelli theorem at face value, then illustrating it is a matter of looking at <span class="math inline">\(\left\lVert\hat F_X - F_X\right\rVert_\infty\)</span> for simulated samples of increasing size <span class="math inline">\(n\)</span>.</p>
<div class="cell" data-hash="nonpar_cache/html/unnamed-chunk-17_e6adcd23d65daec71045b8bc98d0f8a1">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>N_sim <span class="ot">&lt;-</span> <span class="fl">1e3</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>sup_diff <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">"numeric"</span>, N_sim)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (n <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>N_sim) {</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  X <span class="ot">&lt;-</span> <span class="fu">draw_X</span>(n)</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  F_hat <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="fu">seq</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">12</span>, <span class="at">length =</span> <span class="fl">1e5</span>), emp_dist, <span class="at">sample =</span> X)</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>  F_0 <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="fu">seq</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">12</span>, <span class="at">length =</span> <span class="fl">1e5</span>), F_X)</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>  sup_diff[n] <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="fu">abs</span>(F_hat <span class="sc">-</span> F_0))</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center" data-fig.asp="0.7" data-hash="nonpar_cache/html/fig-plot412e1741923_d9c647b006a3efc2ab50997249fb758e">
<details>
<summary>Show code which generates figure</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">n =</span> <span class="dv">1</span><span class="sc">:</span>N_sim,</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  sup_diff</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(n, sup_diff)) <span class="sc">+</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span> </span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"sup |eCDF - CDF|"</span>, <span class="at">x =</span><span class="st">"Sample Size, n"</span>) <span class="sc">+</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-plot412e1741923" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="nonpar_files/figure-html/fig-plot412e1741923-1.png" class="img-fluid figure-img" width="768"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;9.8: <strong>?(caption)</strong></figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>While this illustration corroborates the Glivenko-Cantelli theorem, it doesn’t look at it through the lens that matters. A better way to visualize the theorem is by looking at how the shape of <span class="math inline">\(\hat F_X\)</span> behaves as <span class="math inline">\(n\to\infty\)</span>.</p>
<div class="cell" data-hash="nonpar_cache/html/unnamed-chunk-19_0594d744bc257814be6f1ecf76d0ed3b">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>estimates <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>iter <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (n <span class="cf">in</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">25</span>, <span class="dv">50</span>, <span class="dv">100</span>, <span class="dv">500</span>, <span class="dv">1000</span>)) {</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  iter <span class="ot">&lt;-</span> iter <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  X <span class="ot">&lt;-</span> <span class="fu">draw_X</span>(n)</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>  F_hat <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="fu">seq</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">12</span>, <span class="at">length =</span> <span class="fl">1e5</span>), emp_dist, <span class="at">sample =</span> X)</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>  estimates[[iter]] <span class="ot">&lt;-</span> <span class="fu">tibble</span>(F_hat, n , <span class="at">x =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">12</span>, <span class="at">length =</span> <span class="fl">1e5</span>))</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center" data-fig.asp="0.7" data-hash="nonpar_cache/html/fig-plot412e17412849_02aed7ed3a6f260861fc30e5c87ecfc1">
<details>
<summary>Show code which generates figure</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>estimates <span class="sc">%&gt;%</span> </span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(x, F_hat)) <span class="sc">+</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span> </span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>n) <span class="sc">+</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_function</span>(<span class="at">fun =</span> F_X, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-plot412e17412849" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="nonpar_files/figure-html/fig-plot412e17412849-1.png" class="img-fluid figure-img" width="768"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;9.9: <strong>?(caption)</strong></figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>As <span class="math inline">\(n\to\infty\)</span>, it does in fact appear that the empirical distribution <span class="math inline">\(\hat F_X\)</span> converges to the true distribution <span class="math inline">\(F_X\)</span> <em>uniformly</em>, and not just pointwise.</p>
</div>
<p>The key theorem in empirical process theory gives the limiting distribution of the standardized empirical process <span class="math inline">\(\sqrt{n}(\hat F_X - F)\)</span>. We already know that <span class="math display">\[\sqrt n[\hat F_X(x_0)-  F_X(x_0)] \overset{d}{\to}N(0, F_X(x_0)(1-F_X(x_0)))\]</span> for all fixed <span class="math inline">\(x_0\)</span>, but showing the analogous result for the empirical process <span class="math inline">\(\sqrt{n}(\hat F_X - F)\)</span> requires a bit more care. One needs to make sure that <span class="math inline">\(\hat F_X\)</span> “behaves well” on its support.<a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a> <span class="citation" data-cites="hansen2022probability">Hansen (<a href="references.html#ref-hansen2022probability" role="doc-biblioref">2022</a>)</span> provides a nice discussion of this, while omitting many of the technical details that can be found in <span class="citation" data-cites="van2000asymptotic">Van der Vaart (<a href="references.html#ref-van2000asymptotic" role="doc-biblioref">2000</a>)</span>.</p>
<div id="thm-donsk" class="theorem">
<p><span class="theorem-title"><strong>Theorem 9.3 (Donsker’s Theorem) </strong></span>If <span class="math inline">\(X_1,\ldots,X_n\)</span> are IID random variables with a distribution <span class="math inline">\(F_X\)</span>, then <span class="math display">\[ \sqrt{n}.\]</span></p>
</div>
<div class="proof">
<p><span class="proof-title"><em>Proof</em>. </span>See Theorem 19.3 and Theorem 19.5 of <span class="citation" data-cites="van2000asymptotic">Van der Vaart (<a href="references.html#ref-van2000asymptotic" role="doc-biblioref">2000</a>)</span>.</p>
</div>
<p><span class="citation" data-cites="massart1990tight">Massart (<a href="references.html#ref-massart1990tight" role="doc-biblioref">1990</a>)</span></p>
<div id="prp-" class="theorem proposition">
<p><span class="theorem-title"><strong>Proposition 9.1 (DKW Inequality) </strong></span>See</p>
</div>
<div class="proof">
<p><span class="proof-title"><em>Proof</em>. </span>See <span class="citation" data-cites="massart1990tight">Massart (<a href="references.html#ref-massart1990tight" role="doc-biblioref">1990</a>)</span>.</p>
</div>
<div id="exm-" class="theorem example">
<p><span class="theorem-title"><strong>Example 9.8 (Confidence Bands) </strong></span>t</p>
</div>
<div class="cell" data-hash="nonpar_cache/html/unnamed-chunk-21_1f65e24c31f32a349e72e8463e1ef495">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">draw_X</span>(n)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>F_hat <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="fu">seq</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">12</span>, <span class="at">length =</span> <span class="fl">1e5</span>), emp_dist, <span class="at">sample =</span> X)</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>F_0 <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="fu">seq</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">12</span>, <span class="at">length =</span> <span class="fl">1e5</span>), F_X)</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">12</span>, <span class="at">length =</span> <span class="fl">1e5</span>),</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> <span class="fu">sqrt</span>(n) <span class="sc">*</span> (F_hat <span class="sc">-</span> F_0)</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(x,y)) <span class="sc">+</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="nonpar_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div id="prp-" class="theorem proposition">
<p><span class="theorem-title"><strong>Proposition 9.2 (Goodness of Fit Statistics) </strong></span>t</p>
</div>
<div class="proof">
<p><span class="proof-title"><em>Proof</em>. </span>See Corollary 19.21 of <span class="citation" data-cites="van2000asymptotic">Van der Vaart (<a href="references.html#ref-van2000asymptotic" role="doc-biblioref">2000</a>)</span>. The proof amounts to an application of the continuous mapping theorem to <a href="#thm-donsk">Theorem&nbsp;<span>9.3</span></a>.</p>
</div>
<div class="proof">
<p><span class="proof-title"><em>Proof</em>. </span>See Corollary 19.21 of <span class="citation" data-cites="van2000asymptotic">Van der Vaart (<a href="references.html#ref-van2000asymptotic" role="doc-biblioref">2000</a>)</span>. The proof amounts to an application of the continuous mapping theorem to <a href="#thm-donsk">Theorem&nbsp;<span>9.3</span></a>.</p>
</div>
</section>
</section>
<section id="from-estimating-distributions-to-estimating-densities" class="level2" data-number="9.4">
<h2 data-number="9.4" class="anchored" data-anchor-id="from-estimating-distributions-to-estimating-densities"><span class="header-section-number">9.4</span> From Estimating Distributions to Estimating Densities</h2>
<div id="def-" class="theorem definition">
<p><span class="theorem-title"><strong>Definition 9.4 </strong></span>A <span style="color:red"><strong><em>kernel function</em></strong></span> <span class="math inline">\(K:\mathbb{R}\to\mathbb{R}\)</span> is a function satisfying <span class="math display">\[ \int_{-\infty}^\infty K(u)\ du = 1.\]</span> It is often convenient to assume <span class="math inline">\(K\)</span> is nonnegative, and symmetric: <span class="math display">\[\begin{align*}
K(u) &amp; = K(-u) &amp; \forall u\in \mathbb{R}\\
K(u) &amp; \ge 0 &amp; \forall u\in \mathbb{R}
\end{align*}\]</span></p>
</div>
<div class="remark proof">
<p><span class="proof-title"><em>Remark</em>. </span>This definition of a kernel function in this context is <em>very specific</em>. In general, kernels are generalized versions of positive-definite functions and positive-definite matrices. For instance, when working with spaces of functions there are many situations where we want to apply a transformation to some function <span class="math inline">\(f\)</span> via integration, giving us another function using some “kernel function” <span class="math inline">\(K\)</span>: <span class="math display">\[ (Tf)(u) = \int_{a}^{b}f(x)\cdot K(u,x)\ dx\]</span> On famous example of such a transform is the Fourier transform of a function <span class="math inline">\(f\)</span>, given as <span class="math display">\[ \tilde f(t) = \int_{-\infty}^\infty f(x)\cdot e^{-i2\pi t x}\ dx.\]</span> In this case the kernel function is <span class="math inline">\(K(u,x)=e^{-i2\pi t x}\)</span>. Kernel transformations also appear in probability and statistics,<a href="#fn6" class="footnote-ref" id="fnref6" role="doc-noteref"><sup>6</sup></a> The density of the sum of two independent random variables, say <span class="math inline">\(Z = Y + X\)</span>, is given as <span class="math display">\[ f_Z(t) = \int_{-\infty}^\infty f_X(x)\cdot f_Y(u-x)\ dx.\]</span> The kernel associated with this transformation is <span class="math inline">\(K(u,x)= f_Y(u-x)\)</span>.</p>
</div>
<div id="def-" class="theorem definition">
<p><span class="theorem-title"><strong>Definition 9.5 </strong></span>KDE estimator</p>
</div>
<div class="remark proof">
<p><span class="proof-title"><em>Remark</em>. </span>convolution</p>
</div>
<div class="cell" data-hash="nonpar_cache/html/unnamed-chunk-22_96ecc4b8eace29cf1b8d53c0a96a2beb">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>kde <span class="ot">&lt;-</span> <span class="cf">function</span>(x, sample, K, h){</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># sample size</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">length</span>(sample)</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">#calculate the kernel density estimate at x</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>  (<span class="dv">1</span><span class="sc">/</span>(n<span class="sc">*</span>h)) <span class="sc">*</span> <span class="fu">sum</span>(<span class="fu">K</span>((x <span class="sc">-</span> sample)<span class="sc">/</span>h))</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="nonpar_cache/html/unnamed-chunk-23_d1923e83b05e31d197a60952b5d5e37b">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>uniform <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  (<span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>)<span class="sc">*</span>(<span class="fu">abs</span>(x) <span class="sc">&lt;=</span> <span class="dv">1</span>)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>triangular <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>  (<span class="dv">1</span> <span class="sc">-</span> <span class="fu">abs</span>(x))<span class="sc">*</span>(<span class="fu">abs</span>(x) <span class="sc">&lt;=</span> <span class="dv">1</span>)</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>triweight <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>  (<span class="dv">35</span><span class="sc">/</span><span class="dv">32</span><span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>x<span class="sc">^</span><span class="dv">2</span>)<span class="sc">^</span><span class="dv">3</span>)<span class="sc">*</span>(<span class="fu">abs</span>(x) <span class="sc">&lt;=</span> <span class="dv">1</span>)</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>gauss <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dnorm</span>(x)</span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="nonpar_cache/html/unnamed-chunk-24_c1c52e5cde22a66f6ad05510b943ddb6">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-align: center</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-asp: 1</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 11</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Distribution of estimators for the population variance"</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Show code which generates figure"</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">2</span>, <span class="dv">2</span>, <span class="at">length =</span> <span class="dv">10000</span>),</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">Uniform =</span> <span class="fu">uniform</span>(x),</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">Triangular =</span> <span class="fu">triangular</span>(x),</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">Triweight =</span> <span class="fu">triweight</span>(x),</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">Gaussian =</span> <span class="fu">gauss</span>(x)</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gather</span>(<span class="st">"Kernel"</span>, <span class="st">"val"</span>, <span class="sc">-</span>x) <span class="sc">%&gt;%</span> </span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(x, val, <span class="at">color =</span> Kernel)) <span class="sc">+</span></span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>) <span class="sc">+</span></span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Density"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="nonpar_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell" data-hash="nonpar_cache/html/unnamed-chunk-25_90024bd5365cf5ec0bd4dd19b336328d">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">draw_X</span>(<span class="dv">1000</span>)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="co">#set elements to loop over and support to calculate KDE on </span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>kernels <span class="ot">&lt;-</span> <span class="fu">c</span>(uniform, triangular, triweight, gauss)</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>kernel_names <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Uniform"</span>, <span class="st">"Triangular"</span>, <span class="st">"Triweight"</span>, <span class="st">"Gaussian"</span>)</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>bandwidths <span class="ot">&lt;-</span> <span class="fu">c</span>(.<span class="dv">05</span>, .<span class="dv">1</span>, .<span class="dv">5</span>, <span class="fl">0.75</span>, <span class="dv">1</span>, <span class="dv">2</span>)</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>support <span class="ot">&lt;-</span><span class="fu">seq</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">12</span>, <span class="at">length =</span> <span class="fl">1e3</span>)</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>estimates <span class="ot">&lt;-</span> <span class="fu">expand_grid</span>(<span class="at">x =</span> support, </span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">h =</span> bandwidths, </span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">ker_index =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>            ) <span class="sc">%&gt;%</span> </span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">f_est =</span> <span class="fu">kde</span>(x, <span class="at">sample =</span> X, <span class="at">K =</span> kernels[[ker_index]], h),</span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">Kernel =</span> kernel_names[ker_index]</span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center" data-fig.asp="1" data-hash="nonpar_cache/html/unnamed-chunk-26_c03a56810435943e38c90885a6724aa7">
<details>
<summary>Show code which generates figure</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>estimates <span class="sc">%&gt;%</span> </span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">h =</span> <span class="fu">paste</span>(<span class="st">"h ="</span>, h)) <span class="sc">%&gt;%</span> </span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(x, f_est, <span class="at">color =</span> Kernel)) <span class="sc">+</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(<span class="at">fun =</span> f_X, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span> </span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>h) <span class="sc">+</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color =</span> <span class="st">"Kernel"</span>, <span class="at">y =</span> <span class="st">"Kernel Density Estimate"</span>) <span class="sc">+</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="nonpar_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid figure-img" width="1056"></p>
<p></p><figcaption class="figure-caption">Distribution of estimators for the population variance</figcaption><p></p>
</figure>
</div>
</div>
</div>
</section>
<section id="properties-of-the-kernel-density-estimator" class="level2" data-number="9.5">
<h2 data-number="9.5" class="anchored" data-anchor-id="properties-of-the-kernel-density-estimator"><span class="header-section-number">9.5</span> Properties of the Kernel Density Estimator</h2>
</section>
<section id="kernel-selection" class="level2" data-number="9.6">
<h2 data-number="9.6" class="anchored" data-anchor-id="kernel-selection"><span class="header-section-number">9.6</span> Kernel Selection</h2>
</section>
<section id="bandwidth-selection" class="level2" data-number="9.7">
<h2 data-number="9.7" class="anchored" data-anchor-id="bandwidth-selection"><span class="header-section-number">9.7</span> Bandwidth Selection</h2>
<section id="silvermans-rule-of-thumb" class="level3" data-number="9.7.1">
<h3 data-number="9.7.1" class="anchored" data-anchor-id="silvermans-rule-of-thumb"><span class="header-section-number">9.7.1</span> Silverman’s Rule of Thumb</h3>
</section>
<section id="cross-validation" class="level3" data-number="9.7.2">
<h3 data-number="9.7.2" class="anchored" data-anchor-id="cross-validation"><span class="header-section-number">9.7.2</span> Cross-Validation</h3>
</section>
</section>
<section id="multivariate-kde" class="level2" data-number="9.8">
<h2 data-number="9.8" class="anchored" data-anchor-id="multivariate-kde"><span class="header-section-number">9.8</span> Multivariate KDE</h2>
</section>
<section id="extensions" class="level2" data-number="9.9">
<h2 data-number="9.9" class="anchored" data-anchor-id="extensions"><span class="header-section-number">9.9</span> Extensions</h2>
</section>
<section id="further-reading" class="level2" data-number="9.10">
<h2 data-number="9.10" class="anchored" data-anchor-id="further-reading"><span class="header-section-number">9.10</span> Further Reading</h2>
<p><strong><em>Empirical Process Theory</em></strong>: Chapter 19 of <span class="citation" data-cites="van2000asymptotic">Van der Vaart (<a href="references.html#ref-van2000asymptotic" role="doc-biblioref">2000</a>)</span>, Chapter 18 of <span class="citation" data-cites="hansen2022probability">Hansen (<a href="references.html#ref-hansen2022probability" role="doc-biblioref">2022</a>)</span>, <a href="http://www.stat.columbia.edu/~bodhi/Talks/Emp-Proc-Lecture-Notes.pdf">these notes</a>, or <a href="https://sites.stat.washington.edu/people/jaw/RESEARCH/TALKS/Delft/emp-proc-delft-big.pdf">these notes</a></p>
<p><strong><em>Kernels</em></strong>: https://www.randomservices.org/random/expect/Kernels.html</p>
<p>chrome-extension://efaidnbmnnnibpcajpcglclefindmkaj/http://amadeus.csam.iit.edu/~fass/PDKernels.pdf</p>


<!-- -->

<div id="refs" class="references csl-bib-body hanging-indent" role="doc-bibliography" style="display: none">
<div id="ref-cantelli" class="csl-entry" role="doc-biblioentry">
Cantelli, FP. 1933. <span>“Sulla Determinazione Empirica Delle Leggi Di Probabilita.”</span> <em>Gion. Ist. Ital. Attauri.</em> 4: 421–24.
</div>
<div id="ref-glivenko1933sulla" class="csl-entry" role="doc-biblioentry">
Glivenko, Valery. 1933. <span>“Sulla Determinazione Empirica Delle Leggi Di Probabilita.”</span> <em>Gion. Ist. Ital. Attauri.</em> 4: 92–99.
</div>
<div id="ref-hansen2022probability" class="csl-entry" role="doc-biblioentry">
Hansen, Bruce E. 2022. <em>Probability and Statistics for Economists</em>. Princeton University Press.
</div>
<div id="ref-massart1990tight" class="csl-entry" role="doc-biblioentry">
Massart, Pascal. 1990. <span>“The Tight Constant in the Dvoretzky-Kiefer-Wolfowitz Inequality.”</span> <em>The Annals of Probability</em>, 1269–83.
</div>
<div id="ref-van2000asymptotic" class="csl-entry" role="doc-biblioentry">
Van der Vaart, Aad W. 2000. <em>Asymptotic Statistics</em>. Vol. 3. Cambridge university press.
</div>
</div>
</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p>I’m not going to be formal with defining these parameter spaces.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>Keep in mind that this is <em>not</em> the same as defining <span class="math inline">\(X\)</span> as <span class="math inline">\(X = \sum_\ell X_\ell\)</span>. There is a difference between defining it using the convex combination of densities and simply taking it to be the convex combination of the random variables.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>These spaces both are special cases of what is known as an <span class="math inline">\(L^p\)</span> space, with <span class="math inline">\(L^2\)</span> being of particularly interest because it is the only <span class="math inline">\(L^p\)</span> space that is a Hilbert space.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>Kind of but not really because <span class="math inline">\(\sup\)</span> instead of <span class="math inline">\(\max\)</span>.<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5"><p>In this case behaves well means that the sequence <span class="math inline">\(\hat F_X\)</span> over sample sizes <span class="math inline">\(n\)</span> is <strong><em>asymptotically/stochastically equicontinuous</em></strong>. If you’ve taken a real analysis course, the term equicontinuity may seem familiar as it’s an extension of uniform continuity to a collection of functions. If the collection of <span class="math inline">\(\hat F_X\)</span> over sample sizes <span class="math inline">\(n\)</span> is asymptotically equicontinuous, then for all <span class="math inline">\(n\)</span>, <span class="math inline">\(\hat F_X\)</span> converges uniformly in probability. The magic of uniform convergence is it allows us to interchange many limiting processes, and in this case allows us to conclude that the entire empirical process converges to something related to a normal distribution.<a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn6"><p>This is not to say that the Fourier transformation doesn’t play an important role in probability and statistics. In fact, quite the opposite. The Fourier transformation of a density function is the <strong><em>characteristic function</em></strong>of a random variable, a function with some magical properties.<a href="#fnref6" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./binary.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Binary Choice</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./references.html" class="pagination-link">
        <span class="nav-page-text">References</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb31" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>\DeclareMathOperator{\plim}{plim}</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>\DeclareMathOperator{\argmin}{argmin}</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>\DeclareMathOperator{\argmax}{argmax}</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>\newcommand{\var}<span class="co">[</span><span class="ot">1</span><span class="co">]</span>{\text{Var}\left(#1\right)}</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>\newcommand{\avar}<span class="co">[</span><span class="ot">1</span><span class="co">]</span>{\text{Avar}\left(#1\right)}</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>\newcommand{\E}<span class="co">[</span><span class="ot">1</span><span class="co">]</span>{\text{E}\left<span class="co">[</span><span class="ot">#1\right</span><span class="co">]</span>}</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>\newcommand{\cov}<span class="co">[</span><span class="ot">1</span><span class="co">]</span>{\text{Cov}\left(#1\right)}</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>\newcommand{\mse}<span class="co">[</span><span class="ot">1</span><span class="co">]</span>{\text{MSE}\left(#1\right)}</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>\newcommand{\se}<span class="co">[</span><span class="ot">1</span><span class="co">]</span>{\text{se}\left(#1\right)}</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>\newcommand{\limfunc}{lim} </span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>\newcommand{\X}{\mathbf{X}}</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>\newcommand{\Xm}{\mathbb{X}}</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>\newcommand{\EER}{\bar{\thet}_\text{EE}}</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>\newcommand{\NLS}{\hat{\bet}_\text{NLLS}}</span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>\newcommand{\z}{\mathbf{z}}</span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>\newcommand{\rr}{\mathbf{r}}</span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>\newcommand{\C}{\mathbf{C}}</span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>\newcommand{\Pe}{\mathbf{P}}</span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>\newcommand{\y}{\mathbf{y}}</span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a>\newcommand{\Y}{\mathbf{Y}}</span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a>\newcommand{\uu}{\mathbf{u}}</span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a>\newcommand{\e}{\mathbf{e}}</span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a>\newcommand{\D}{\mathbf{D}}</span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a>\newcommand{\x}{\mathbf{x}}</span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a>\newcommand{\xm}{\mathbb{x}}</span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a>\newcommand{\Zm}{\mathbb{Z}}</span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a>\newcommand{\Wm}{\mathbb{W}}</span>
<span id="cb31-28"><a href="#cb31-28" aria-hidden="true" tabindex="-1"></a>\newcommand{\Hm}{\mathbb{H}}</span>
<span id="cb31-29"><a href="#cb31-29" aria-hidden="true" tabindex="-1"></a>\newcommand{\W}{\mathbf{W}}</span>
<span id="cb31-30"><a href="#cb31-30" aria-hidden="true" tabindex="-1"></a>\newcommand{\Z}{\mathbf{Z}}</span>
<span id="cb31-31"><a href="#cb31-31" aria-hidden="true" tabindex="-1"></a>\newcommand{\Hess}{\mathbf{H}(\mathbf{\Z\mid\thet})}</span>
<span id="cb31-32"><a href="#cb31-32" aria-hidden="true" tabindex="-1"></a>\newcommand{\Score}{\mathbf{S}(\mathbf{\Z\mid\thet})}</span>
<span id="cb31-33"><a href="#cb31-33" aria-hidden="true" tabindex="-1"></a>\newcommand{\A}{\mathbf{A}}</span>
<span id="cb31-34"><a href="#cb31-34" aria-hidden="true" tabindex="-1"></a>\newcommand{\h}{\mathbf{h}}</span>
<span id="cb31-35"><a href="#cb31-35" aria-hidden="true" tabindex="-1"></a>\newcommand{\Q}{\mathbf{Q}}</span>
<span id="cb31-36"><a href="#cb31-36" aria-hidden="true" tabindex="-1"></a>\newcommand{\F}{\mathbf{F}}</span>
<span id="cb31-37"><a href="#cb31-37" aria-hidden="true" tabindex="-1"></a>\newcommand{\G}{\mathbf{G}}</span>
<span id="cb31-38"><a href="#cb31-38" aria-hidden="true" tabindex="-1"></a>\newcommand{\I}{\mathbf{I}}</span>
<span id="cb31-39"><a href="#cb31-39" aria-hidden="true" tabindex="-1"></a>\renewcommand{\D}{\mathbf{D}}</span>
<span id="cb31-40"><a href="#cb31-40" aria-hidden="true" tabindex="-1"></a>\renewcommand{\C}{\mathbf{C}}</span>
<span id="cb31-41"><a href="#cb31-41" aria-hidden="true" tabindex="-1"></a>\newcommand{\zer}{\mathbf{0}}</span>
<span id="cb31-42"><a href="#cb31-42" aria-hidden="true" tabindex="-1"></a>\newcommand{\OLS}{\hat{\boldsymbol\beta}_\text{OLS} }</span>
<span id="cb31-43"><a href="#cb31-43" aria-hidden="true" tabindex="-1"></a>\newcommand{\OLSOV}{\hat{\boldsymbol\beta}_\text{OLS,OV} }</span>
<span id="cb31-44"><a href="#cb31-44" aria-hidden="true" tabindex="-1"></a>\newcommand{\OLSME}{\hat{\boldsymbol\beta}_\text{OLS,ME} }</span>
<span id="cb31-45"><a href="#cb31-45" aria-hidden="true" tabindex="-1"></a>\newcommand{\EE}{\hat{\boldsymbol\theta}_\text{EX} }</span>
<span id="cb31-46"><a href="#cb31-46" aria-hidden="true" tabindex="-1"></a>\newcommand{\ME}{\hat{\boldsymbol\theta}_\text{M} }</span>
<span id="cb31-47"><a href="#cb31-47" aria-hidden="true" tabindex="-1"></a>\newcommand{\MDE}{\hat{\boldsymbol\theta}_\text{MDE} }</span>
<span id="cb31-48"><a href="#cb31-48" aria-hidden="true" tabindex="-1"></a>\newcommand{\IV}{\hat{\boldsymbol\beta}_\text{IV} }</span>
<span id="cb31-49"><a href="#cb31-49" aria-hidden="true" tabindex="-1"></a>\newcommand{\TSLS}{\hat{\boldsymbol\beta}_\text{2SLS} }</span>
<span id="cb31-50"><a href="#cb31-50" aria-hidden="true" tabindex="-1"></a>\newcommand{\thet}{\boldsymbol{\theta}}</span>
<span id="cb31-51"><a href="#cb31-51" aria-hidden="true" tabindex="-1"></a>\newcommand{\et}{\boldsymbol{\eta}}</span>
<span id="cb31-52"><a href="#cb31-52" aria-hidden="true" tabindex="-1"></a>\newcommand{\R}{\mathbb{R}}</span>
<span id="cb31-53"><a href="#cb31-53" aria-hidden="true" tabindex="-1"></a>\newcommand{\Sig}{\boldsymbol{\Sigma}}</span>
<span id="cb31-54"><a href="#cb31-54" aria-hidden="true" tabindex="-1"></a>\newcommand{\ep}{\boldsymbol{\varepsilon}}</span>
<span id="cb31-55"><a href="#cb31-55" aria-hidden="true" tabindex="-1"></a>\newcommand{\Omeg}{\boldsymbol{\Omega}}</span>
<span id="cb31-56"><a href="#cb31-56" aria-hidden="true" tabindex="-1"></a>\newcommand{\Thet}{\boldsymbol{\Theta}}</span>
<span id="cb31-57"><a href="#cb31-57" aria-hidden="true" tabindex="-1"></a>\newcommand{\bet}{\boldsymbol{\beta}}</span>
<span id="cb31-58"><a href="#cb31-58" aria-hidden="true" tabindex="-1"></a>\newcommand{\rk}{rank}</span>
<span id="cb31-59"><a href="#cb31-59" aria-hidden="true" tabindex="-1"></a>\newcommand{\tsum}{\sum}</span>
<span id="cb31-60"><a href="#cb31-60" aria-hidden="true" tabindex="-1"></a>\newcommand{\tr}{tr}</span>
<span id="cb31-61"><a href="#cb31-61" aria-hidden="true" tabindex="-1"></a>\newcommand{\norm}<span class="co">[</span><span class="ot">1</span><span class="co">]</span>{\left\lVert#1\right\rVert}</span>
<span id="cb31-62"><a href="#cb31-62" aria-hidden="true" tabindex="-1"></a>\newcommand{\abs}<span class="co">[</span><span class="ot">1</span><span class="co">]</span>{\left\lvert#1\right\rvert}</span>
<span id="cb31-63"><a href="#cb31-63" aria-hidden="true" tabindex="-1"></a>\newcommand{\ms}{\overset{ms}{\to}}</span>
<span id="cb31-64"><a href="#cb31-64" aria-hidden="true" tabindex="-1"></a>\newcommand{\pto}{\overset{p}{\to}}</span>
<span id="cb31-65"><a href="#cb31-65" aria-hidden="true" tabindex="-1"></a>\newcommand{\iid}{\overset{iid}{\sim}}</span>
<span id="cb31-66"><a href="#cb31-66" aria-hidden="true" tabindex="-1"></a>\newcommand{\dto}{\overset{d}{\to}}</span>
<span id="cb31-67"><a href="#cb31-67" aria-hidden="true" tabindex="-1"></a>\newcommand{\asim}{\overset{a}{\sim}}</span>
<span id="cb31-68"><a href="#cb31-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-69"><a href="#cb31-69" aria-hidden="true" tabindex="-1"></a><span class="fu"># Nonparametrics I: Distribution and Density Estimation</span></span>
<span id="cb31-70"><a href="#cb31-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-73"><a href="#cb31-73" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb31-74"><a href="#cb31-74" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb31-75"><a href="#cb31-75" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb31-76"><a href="#cb31-76" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb31-77"><a href="#cb31-77" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb31-78"><a href="#cb31-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-79"><a href="#cb31-79" aria-hidden="true" tabindex="-1"></a>Perhaps one of the most fundamental questions one can ask given observations of a random variable is "what distribution did these come from?" This section aims to answer this question under only one major assumption -- the observed data is an IID sample. </span>
<span id="cb31-80"><a href="#cb31-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-81"><a href="#cb31-81" aria-hidden="true" tabindex="-1"></a>::: {#def-}</span>
<span id="cb31-82"><a href="#cb31-82" aria-hidden="true" tabindex="-1"></a>Define the <span class="kw">&lt;span</span> <span class="er">style</span><span class="ot">=</span><span class="st">"color:red"</span><span class="kw">&gt;</span>**_IID model_**<span class="kw">&lt;/span&gt;</span> as </span>
<span id="cb31-83"><a href="#cb31-83" aria-hidden="true" tabindex="-1"></a>$$\mathcal P_\text{IID} = \left<span class="sc">\{</span>F_{\X_1,\ldots,\X_n} \mid F_{\X_1,\ldots,\X_n}\text{ is a valid distribution and } \X_i = \X_j\  \forall i\neq j \right<span class="sc">\}</span>,$$ or $$\mathcal P_\text{IID} = \left<span class="sc">\{</span>f_{\X_1,\ldots,\X_n} \mid f_{\X_1,\ldots,\X_n}\text{ is a valid density and } \X_i = \X_j\  \forall i\neq j \right<span class="sc">\}</span>.$$ The model is parameterized by the common marginal distribution/density which we will write at $F_{\X}$ and $f_{\X}$.  </span>
<span id="cb31-84"><a href="#cb31-84" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-85"><a href="#cb31-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-86"><a href="#cb31-86" aria-hidden="true" tabindex="-1"></a>Things get a bit annoying with notation as a result of models (roughly speaking) being the joint distribution of a sample. We're interested in a situation where we observe $n$ values of some random vector $\X$ and want to estimate $F_\X$ and/or $f_\X$. This sample is a collection of identical random vectors $(\X_1,\ldots,\X_n)$, so the model is technically the collection of these joint distributions / densities. Of course, because $(\X_1,\ldots,\X_n)$ are identically distributed, considering the joint density is moot, and the model is identified by parameterizing it by the distribution / density of $\X$. As such, we want to develop estimators $\hat F_{\X}(\x)$ and $\hat{f}_\X(\x)$. The novelty of this task comes from the fact that the parameter space, which is the set of all probability distributions or probability densities,^<span class="co">[</span><span class="ot">I'm not going to be formal with defining these parameter spaces.</span><span class="co">]</span> has infinite dimension. This makes our model nonparametric.  </span>
<span id="cb31-87"><a href="#cb31-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-88"><a href="#cb31-88" aria-hidden="true" tabindex="-1"></a>For most of the section, we'll handle the simple case of estimating the distribution and density of a random scalar $X$, whose sample is the joint random vector $\X = (X_1, \ldots, X_n)$. For many of the examples, we'll simulate our data from a specific distribution that is sufficiently "weird" enough to give a sense for how estimators behave in the absence of "nice" distributions like the standard normal. This specific distribution will be mixed normal distribution that is defined in the following example.</span>
<span id="cb31-89"><a href="#cb31-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-90"><a href="#cb31-90" aria-hidden="true" tabindex="-1"></a>::: {#exm-}</span>
<span id="cb31-91"><a href="#cb31-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-92"><a href="#cb31-92" aria-hidden="true" tabindex="-1"></a><span class="fu">## Mixed Normal Distribution</span></span>
<span id="cb31-93"><a href="#cb31-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-94"><a href="#cb31-94" aria-hidden="true" tabindex="-1"></a>Suppose we have $L$ random variables $X_\ell$. We can define a new random variable $X$ by defining $f_X$ to be a convex combination of each density $f_{X_\ell}$, in effect "mixing" $X_\ell$. For each $\ell$, define a mixing probability $p_\ell$ such that $\sum_\ell p_\ell = 1$. Taking the linear combination of each density $f_{X_\ell}$ with these weights gives </span>
<span id="cb31-95"><a href="#cb31-95" aria-hidden="true" tabindex="-1"></a>$$ f_X(x) = \sum_{\ell=1}^Lp_\ell f_{X_\ell}(x).$$ This process gives a random variable $X$ with the following interpretation -- with probability $p_\ell$, $X = X_\ell$.^<span class="co">[</span><span class="ot">Keep in mind that this is *not* the same as defining $X$ as $X = \sum_\ell X_\ell$. There is a difference between defining it using the convex combination of densities and simply taking it to be the convex combination of the random variables.</span><span class="co">]</span> The distribution function of $X$ is given by the analagous convex combination of distributions $F_X$, as differentiation and integration are linear operations.</span>
<span id="cb31-96"><a href="#cb31-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-97"><a href="#cb31-97" aria-hidden="true" tabindex="-1"></a>$$F_X(x) = \sum_{\ell=1}^Lp_\ell F_{X_\ell}(x)$$</span>
<span id="cb31-98"><a href="#cb31-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-99"><a href="#cb31-99" aria-hidden="true" tabindex="-1"></a>Suppose we have four normally distributed random variables:</span>
<span id="cb31-100"><a href="#cb31-100" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb31-101"><a href="#cb31-101" aria-hidden="true" tabindex="-1"></a>X_1 &amp; \sim N(0, (0.2)^2),<span class="sc">\\</span></span>
<span id="cb31-102"><a href="#cb31-102" aria-hidden="true" tabindex="-1"></a>X_2 &amp; \sim N(1.5, (0.5)^2),<span class="sc">\\</span></span>
<span id="cb31-103"><a href="#cb31-103" aria-hidden="true" tabindex="-1"></a>X_3 &amp; \sim N(4.1, (0.8)^2),<span class="sc">\\</span></span>
<span id="cb31-104"><a href="#cb31-104" aria-hidden="true" tabindex="-1"></a>X_4 &amp; \sim N(8, (1.5)^2).</span>
<span id="cb31-105"><a href="#cb31-105" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb31-106"><a href="#cb31-106" aria-hidden="true" tabindex="-1"></a>Define $X$ to be the mixture of these variables, where the mixing weights are all set to $1/4$. Let's define functions which give $F_X$ and $f_X$, along with one that draws random values of $X$.</span>
<span id="cb31-107"><a href="#cb31-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-110"><a href="#cb31-110" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb31-111"><a href="#cb31-111" aria-hidden="true" tabindex="-1"></a>F_X <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb31-112"><a href="#cb31-112" aria-hidden="true" tabindex="-1"></a>  <span class="fl">0.25</span><span class="sc">*</span><span class="fu">pnorm</span>(x, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="fl">0.2</span>) <span class="sc">+</span> </span>
<span id="cb31-113"><a href="#cb31-113" aria-hidden="true" tabindex="-1"></a>  <span class="fl">0.25</span><span class="sc">*</span><span class="fu">pnorm</span>(x, <span class="at">mean =</span> <span class="fl">1.5</span>, <span class="at">sd =</span> <span class="fl">0.5</span>) <span class="sc">+</span> </span>
<span id="cb31-114"><a href="#cb31-114" aria-hidden="true" tabindex="-1"></a>  <span class="fl">0.25</span><span class="sc">*</span><span class="fu">pnorm</span>(x, <span class="at">mean =</span> <span class="fl">4.1</span>, <span class="at">sd =</span> <span class="fl">0.8</span>) <span class="sc">+</span> </span>
<span id="cb31-115"><a href="#cb31-115" aria-hidden="true" tabindex="-1"></a>  <span class="fl">0.25</span><span class="sc">*</span><span class="fu">pnorm</span>(x, <span class="at">mean =</span> <span class="dv">8</span>, <span class="at">sd =</span> <span class="fl">1.5</span>)</span>
<span id="cb31-116"><a href="#cb31-116" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-117"><a href="#cb31-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-118"><a href="#cb31-118" aria-hidden="true" tabindex="-1"></a>f_X <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb31-119"><a href="#cb31-119" aria-hidden="true" tabindex="-1"></a>  <span class="fl">0.25</span><span class="sc">*</span><span class="fu">dnorm</span>(x, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb31-120"><a href="#cb31-120" aria-hidden="true" tabindex="-1"></a>  <span class="fl">0.25</span><span class="sc">*</span><span class="fu">dnorm</span>(x, <span class="at">mean =</span> <span class="fl">1.5</span>, <span class="at">sd =</span> <span class="fl">0.5</span>) <span class="sc">+</span> </span>
<span id="cb31-121"><a href="#cb31-121" aria-hidden="true" tabindex="-1"></a>  <span class="fl">0.25</span><span class="sc">*</span><span class="fu">dnorm</span>(x, <span class="at">mean =</span> <span class="fl">4.1</span>, <span class="at">sd =</span> <span class="fl">0.8</span>) <span class="sc">+</span> </span>
<span id="cb31-122"><a href="#cb31-122" aria-hidden="true" tabindex="-1"></a>  <span class="fl">0.25</span><span class="sc">*</span><span class="fu">dnorm</span>(x, <span class="at">mean =</span> <span class="dv">8</span>, <span class="at">sd =</span> <span class="fl">1.5</span>)</span>
<span id="cb31-123"><a href="#cb31-123" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-124"><a href="#cb31-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-125"><a href="#cb31-125" aria-hidden="true" tabindex="-1"></a>draw_X <span class="ot">&lt;-</span> <span class="cf">function</span>(n){</span>
<span id="cb31-126"><a href="#cb31-126" aria-hidden="true" tabindex="-1"></a>  <span class="co"># make n draws from (1,2,3,4) with equal probability</span></span>
<span id="cb31-127"><a href="#cb31-127" aria-hidden="true" tabindex="-1"></a>  index <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>), n, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb31-128"><a href="#cb31-128" aria-hidden="true" tabindex="-1"></a>  (index <span class="sc">==</span> <span class="dv">1</span>)<span class="sc">*</span><span class="fu">rnorm</span>(n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="fl">0.2</span>)  <span class="sc">+</span> </span>
<span id="cb31-129"><a href="#cb31-129" aria-hidden="true" tabindex="-1"></a>  (index <span class="sc">==</span> <span class="dv">2</span>)<span class="sc">*</span><span class="fu">rnorm</span>(n, <span class="at">mean =</span> <span class="fl">1.5</span>, <span class="at">sd =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb31-130"><a href="#cb31-130" aria-hidden="true" tabindex="-1"></a>  (index <span class="sc">==</span> <span class="dv">3</span>)<span class="sc">*</span><span class="fu">rnorm</span>(n, <span class="at">mean =</span> <span class="fl">4.1</span>, <span class="at">sd =</span> <span class="fl">0.8</span>) <span class="sc">+</span> </span>
<span id="cb31-131"><a href="#cb31-131" aria-hidden="true" tabindex="-1"></a>  (index <span class="sc">==</span> <span class="dv">4</span>)<span class="sc">*</span><span class="fu">rnorm</span>(n, <span class="at">mean =</span> <span class="dv">8</span>, <span class="at">sd =</span> <span class="fl">1.5</span>)</span>
<span id="cb31-132"><a href="#cb31-132" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-133"><a href="#cb31-133" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb31-134"><a href="#cb31-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-135"><a href="#cb31-135" aria-hidden="true" tabindex="-1"></a>To get a better sense of $X$, let's look at it's distribution and density. </span>
<span id="cb31-136"><a href="#cb31-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-139"><a href="#cb31-139" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb31-140"><a href="#cb31-140" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb31-141"><a href="#cb31-141" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-plot412e1</span></span>
<span id="cb31-142"><a href="#cb31-142" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-align: center</span></span>
<span id="cb31-143"><a href="#cb31-143" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-asp: 0.7</span></span>
<span id="cb31-144"><a href="#cb31-144" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 8</span></span>
<span id="cb31-145"><a href="#cb31-145" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: " "</span></span>
<span id="cb31-146"><a href="#cb31-146" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Show code which generates figure"</span></span>
<span id="cb31-147"><a href="#cb31-147" aria-hidden="true" tabindex="-1"></a><span class="fu">expand_grid</span>(<span class="at">x =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">12</span>, <span class="at">length =</span> <span class="fl">1e5</span>), <span class="at">func =</span> <span class="fu">c</span>(<span class="st">"Density"</span>, <span class="st">"Distribution"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb31-148"><a href="#cb31-148" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb31-149"><a href="#cb31-149" aria-hidden="true" tabindex="-1"></a>    <span class="at">X1 =</span> <span class="fu">ifelse</span>(func <span class="sc">==</span> <span class="st">"Density"</span>, <span class="fu">dnorm</span>(x, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="fl">0.2</span>), <span class="fu">pnorm</span>(x, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="fl">0.2</span>)),</span>
<span id="cb31-150"><a href="#cb31-150" aria-hidden="true" tabindex="-1"></a>    <span class="at">X2 =</span> <span class="fu">ifelse</span>(func <span class="sc">==</span> <span class="st">"Density"</span>, <span class="fu">dnorm</span>(x, <span class="at">mean =</span> <span class="fl">1.5</span>, <span class="at">sd =</span> <span class="fl">0.5</span>), <span class="fu">pnorm</span>(x, <span class="at">mean =</span> <span class="fl">1.5</span>, <span class="at">sd =</span> <span class="fl">0.5</span>)),</span>
<span id="cb31-151"><a href="#cb31-151" aria-hidden="true" tabindex="-1"></a>    <span class="at">X3 =</span> <span class="fu">ifelse</span>(func <span class="sc">==</span> <span class="st">"Density"</span>, <span class="fu">dnorm</span>(x, <span class="at">mean =</span> <span class="fl">4.1</span>, <span class="at">sd =</span> <span class="fl">0.8</span>), <span class="fu">pnorm</span>(x, <span class="at">mean =</span> <span class="fl">4.1</span>, <span class="at">sd =</span> <span class="fl">0.8</span>)),</span>
<span id="cb31-152"><a href="#cb31-152" aria-hidden="true" tabindex="-1"></a>    <span class="at">X4 =</span> <span class="fu">ifelse</span>(func <span class="sc">==</span> <span class="st">"Density"</span>, <span class="fu">dnorm</span>(x, <span class="at">mean =</span> <span class="dv">8</span>, <span class="at">sd =</span> <span class="fl">1.5</span>), <span class="fu">pnorm</span>(x, <span class="at">mean =</span> <span class="dv">8</span>, <span class="at">sd =</span> <span class="fl">1.5</span>)),</span>
<span id="cb31-153"><a href="#cb31-153" aria-hidden="true" tabindex="-1"></a>    <span class="at">X =</span> <span class="fu">ifelse</span>(func <span class="sc">==</span> <span class="st">"Density"</span>, <span class="fu">f_X</span>(x), <span class="fu">F_X</span>(x))</span>
<span id="cb31-154"><a href="#cb31-154" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb31-155"><a href="#cb31-155" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gather</span>(<span class="st">"RV"</span>, <span class="st">"val"</span>, <span class="sc">-</span>x, <span class="sc">-</span>func) <span class="sc">%&gt;%</span> </span>
<span id="cb31-156"><a href="#cb31-156" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">group =</span> <span class="fu">ifelse</span>(RV <span class="sc">==</span> <span class="st">"X"</span>, <span class="st">"Mixture"</span>, <span class="st">"Indiviudal"</span>))  <span class="sc">%&gt;%</span> </span>
<span id="cb31-157"><a href="#cb31-157" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(x, val, <span class="at">color =</span> RV)) <span class="sc">+</span></span>
<span id="cb31-158"><a href="#cb31-158" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb31-159"><a href="#cb31-159" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"black"</span>, <span class="st">"red"</span>, <span class="st">"blue"</span>, <span class="st">"green"</span>, <span class="st">"orange"</span>)) <span class="sc">+</span> </span>
<span id="cb31-160"><a href="#cb31-160" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="at">rows =</span> <span class="fu">vars</span>(group), <span class="at">cols =</span> <span class="fu">vars</span>(func), <span class="at">scales =</span> <span class="st">"free"</span>, <span class="at">switch =</span> <span class="st">"y"</span>) <span class="sc">+</span></span>
<span id="cb31-161"><a href="#cb31-161" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb31-162"><a href="#cb31-162" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb31-163"><a href="#cb31-163" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">""</span>)</span>
<span id="cb31-164"><a href="#cb31-164" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb31-165"><a href="#cb31-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-166"><a href="#cb31-166" aria-hidden="true" tabindex="-1"></a>Later on, we'll also be interested in the derivatives of the density $f_X$. For any normally distributed random variable $Y$, the first two derivatives of $f_Y$ are:</span>
<span id="cb31-167"><a href="#cb31-167" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb31-168"><a href="#cb31-168" aria-hidden="true" tabindex="-1"></a>f_Y'(y) &amp; = -\frac{y-\mu}{\sigma^2}f_Y(y), <span class="sc">\\</span></span>
<span id="cb31-169"><a href="#cb31-169" aria-hidden="true" tabindex="-1"></a>f_Y''(y) &amp; =  \left(\frac{(y-\mu)^2}{\sigma^4} -\frac{1}{\sigma^2}\right) f_Y(y).</span>
<span id="cb31-170"><a href="#cb31-170" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb31-171"><a href="#cb31-171" aria-hidden="true" tabindex="-1"></a>The density $f_X$ is just a linear combination of various normal densities, so it's derivatives are the linear combinations of the corresponding derivatives.</span>
<span id="cb31-172"><a href="#cb31-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-175"><a href="#cb31-175" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb31-176"><a href="#cb31-176" aria-hidden="true" tabindex="-1"></a>df_dx <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb31-177"><a href="#cb31-177" aria-hidden="true" tabindex="-1"></a>  <span class="sc">-</span> ((x<span class="dv">-0</span>)<span class="sc">/</span><span class="fl">0.2</span><span class="sc">^</span><span class="dv">2</span>)<span class="sc">*</span><span class="fl">0.25</span><span class="sc">*</span><span class="fu">dnorm</span>(x, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="fl">0.2</span>) <span class="sc">-</span> </span>
<span id="cb31-178"><a href="#cb31-178" aria-hidden="true" tabindex="-1"></a>  ((x<span class="fl">-1.5</span>)<span class="sc">/</span><span class="fl">0.5</span><span class="sc">^</span><span class="dv">2</span>)<span class="sc">*</span><span class="fl">0.25</span><span class="sc">*</span><span class="fu">dnorm</span>(x, <span class="at">mean =</span> <span class="fl">1.5</span>, <span class="at">sd =</span> <span class="fl">0.5</span>) <span class="sc">-</span></span>
<span id="cb31-179"><a href="#cb31-179" aria-hidden="true" tabindex="-1"></a>  ((x<span class="fl">-4.1</span>)<span class="sc">/</span><span class="fl">0.8</span><span class="sc">^</span><span class="dv">2</span>)<span class="sc">*</span><span class="fl">0.25</span><span class="sc">*</span><span class="fu">dnorm</span>(x, <span class="at">mean =</span> <span class="fl">4.1</span>, <span class="at">sd =</span> <span class="fl">0.8</span>) <span class="sc">-</span> </span>
<span id="cb31-180"><a href="#cb31-180" aria-hidden="true" tabindex="-1"></a>  ((x<span class="dv">-8</span>)<span class="sc">/</span><span class="fl">1.5</span><span class="sc">^</span><span class="dv">2</span>)<span class="sc">*</span><span class="fl">0.25</span><span class="sc">*</span><span class="fu">dnorm</span>(x, <span class="at">mean =</span> <span class="dv">8</span>, <span class="at">sd =</span> <span class="fl">1.5</span>)</span>
<span id="cb31-181"><a href="#cb31-181" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-182"><a href="#cb31-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-183"><a href="#cb31-183" aria-hidden="true" tabindex="-1"></a>df2_dx2 <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb31-184"><a href="#cb31-184" aria-hidden="true" tabindex="-1"></a>  ((x<span class="dv">-0</span>)<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span><span class="fl">0.2</span><span class="sc">^</span><span class="dv">4</span> <span class="sc">-</span> <span class="dv">1</span><span class="sc">/</span><span class="fl">0.2</span><span class="sc">^</span><span class="dv">2</span>)<span class="sc">*</span><span class="fl">0.25</span><span class="sc">*</span><span class="fu">dnorm</span>(x, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb31-185"><a href="#cb31-185" aria-hidden="true" tabindex="-1"></a>  ((x<span class="fl">-1.5</span>)<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span><span class="fl">0.5</span><span class="sc">^</span><span class="dv">4</span> <span class="sc">-</span> <span class="dv">1</span><span class="sc">/</span><span class="fl">0.5</span><span class="sc">^</span><span class="dv">2</span>)<span class="sc">*</span> <span class="fl">0.25</span><span class="sc">*</span><span class="fu">dnorm</span>(x, <span class="at">mean =</span> <span class="fl">1.5</span>, <span class="at">sd =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb31-186"><a href="#cb31-186" aria-hidden="true" tabindex="-1"></a>  ((x<span class="fl">-4.1</span>)<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span><span class="fl">0.8</span><span class="sc">^</span><span class="dv">4</span> <span class="sc">-</span> <span class="dv">1</span><span class="sc">/</span><span class="fl">0.8</span><span class="sc">^</span><span class="dv">2</span>)<span class="sc">*</span><span class="fl">0.25</span><span class="sc">*</span><span class="fu">dnorm</span>(x, <span class="at">mean =</span> <span class="fl">4.1</span>, <span class="at">sd =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb31-187"><a href="#cb31-187" aria-hidden="true" tabindex="-1"></a>  ((x<span class="dv">-8</span>)<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span><span class="fl">1.5</span><span class="sc">^</span><span class="dv">4</span> <span class="sc">-</span> <span class="dv">1</span><span class="sc">/</span><span class="fl">1.5</span><span class="sc">^</span><span class="dv">2</span>)<span class="sc">*</span><span class="fl">0.25</span><span class="sc">*</span><span class="fu">dnorm</span>(x, <span class="at">mean =</span> <span class="dv">8</span>, <span class="at">sd =</span> <span class="fl">1.5</span>)</span>
<span id="cb31-188"><a href="#cb31-188" aria-hidden="true" tabindex="-1"></a>} </span>
<span id="cb31-189"><a href="#cb31-189" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb31-190"><a href="#cb31-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-193"><a href="#cb31-193" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb31-194"><a href="#cb31-194" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb31-195"><a href="#cb31-195" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-plot412e17</span></span>
<span id="cb31-196"><a href="#cb31-196" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-align: center</span></span>
<span id="cb31-197"><a href="#cb31-197" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-asp: 0.7</span></span>
<span id="cb31-198"><a href="#cb31-198" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 8</span></span>
<span id="cb31-199"><a href="#cb31-199" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: " "</span></span>
<span id="cb31-200"><a href="#cb31-200" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Show code which generates figure"</span></span>
<span id="cb31-201"><a href="#cb31-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-202"><a href="#cb31-202" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">12</span>, <span class="at">length =</span> <span class="fl">1e5</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb31-203"><a href="#cb31-203" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb31-204"><a href="#cb31-204" aria-hidden="true" tabindex="-1"></a>    <span class="at">Density =</span> <span class="fu">f_X</span>(x),</span>
<span id="cb31-205"><a href="#cb31-205" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">First Derivative</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">df_dx</span>(x),</span>
<span id="cb31-206"><a href="#cb31-206" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Second Derivative</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">df2_dx2</span>(x)</span>
<span id="cb31-207"><a href="#cb31-207" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb31-208"><a href="#cb31-208" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gather</span>(<span class="st">"func"</span>, <span class="st">"value"</span>, <span class="sc">-</span>x) <span class="sc">%&gt;%</span> </span>
<span id="cb31-209"><a href="#cb31-209" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(x, value)) <span class="sc">+</span></span>
<span id="cb31-210"><a href="#cb31-210" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb31-211"><a href="#cb31-211" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>func, <span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb31-212"><a href="#cb31-212" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb31-213"><a href="#cb31-213" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">""</span>)</span>
<span id="cb31-214"><a href="#cb31-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-215"><a href="#cb31-215" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb31-216"><a href="#cb31-216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-217"><a href="#cb31-217" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-218"><a href="#cb31-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-219"><a href="#cb31-219" aria-hidden="true" tabindex="-1"></a><span class="fu">## Math Preliminaries</span></span>
<span id="cb31-220"><a href="#cb31-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-221"><a href="#cb31-221" aria-hidden="true" tabindex="-1"></a>Until now, we've be focused on estimating parametric models, i.e models where parameters had finite dimension. Even more precisely, all the the estimands up until this point have been elements of $\R^n$, a space we're familiar with. Now that we're concerned with estimating a probability density $f,$ we're estimating entire functions that belong to spaces of functions with infinite dimension. This will require the introduction of some light functional analysis. Some of this discussion will be similar to that in @sec-proj.  </span>
<span id="cb31-222"><a href="#cb31-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-223"><a href="#cb31-223" aria-hidden="true" tabindex="-1"></a>The space $\R^k$ is a *normed vector space* equipped with, as the name implies, a special function called a *norm* which measures a vector's distance from the origin. In the case of $\R^k$, this norm is usually given as </span>
<span id="cb31-224"><a href="#cb31-224" aria-hidden="true" tabindex="-1"></a>$$ \norm{\x}_2 = \left(\sum_{i=1}^n x_i^2\right)^{1/2},$$ and is called the *Euclidean norm*. Any norm can be used to define a metric (a function which measures the distance between two vectors), and in the case of $\R^k$ we have </span>
<span id="cb31-225"><a href="#cb31-225" aria-hidden="true" tabindex="-1"></a>$$ \norm{\x -\y}_2 = \left(\sum_{i=1}^n (x_i-y_i)^2\right)^{1/2}.$$ All we've done is introduce some definitions and notation to the familiar formula used to measure the distance between two points in Euclidean space. In general we can define the $p$-norm on $\R^k$ as </span>
<span id="cb31-226"><a href="#cb31-226" aria-hidden="true" tabindex="-1"></a>$$ \norm{\x}_p = \left(\sum_{i=1}^n \abs{x_i}^p\right)^{1/p}.$$ If we let $p = 2$, we end up with the Euclidean norm. Why bother considering other values of $p$? We can think of $p$ as the way we weight the component-wise "distances" from the origin $\abs{x_1},\abs{x_2},\ldots \abs{x_k}$. For $p = 2$, we square each of these distances (meaning the result is always positive rendering the absolute value moot), assigning more weight to components where $x_i$ is relatively large. </span>
<span id="cb31-227"><a href="#cb31-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-228"><a href="#cb31-228" aria-hidden="true" tabindex="-1"></a>::: {#exm-}</span>
<span id="cb31-229"><a href="#cb31-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-230"><a href="#cb31-230" aria-hidden="true" tabindex="-1"></a><span class="fu">## p = 1</span></span>
<span id="cb31-231"><a href="#cb31-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-232"><a href="#cb31-232" aria-hidden="true" tabindex="-1"></a>If we let $p = 1$, the $p$-norm simplifies to </span>
<span id="cb31-233"><a href="#cb31-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-234"><a href="#cb31-234" aria-hidden="true" tabindex="-1"></a>$$\norm{\x}_1 = \sum_{i=1}^n \abs{x_i}.$$</span>
<span id="cb31-235"><a href="#cb31-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-236"><a href="#cb31-236" aria-hidden="true" tabindex="-1"></a>This norm induces the "taxi-cab metric",</span>
<span id="cb31-237"><a href="#cb31-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-238"><a href="#cb31-238" aria-hidden="true" tabindex="-1"></a>$$\norm{\x - \y}_1 = \sum_{i=1}^n \abs{x_i - y_i},$$ whose name follows from how you would define distance if you were driving between two points in a city with a grid layout.</span>
<span id="cb31-239"><a href="#cb31-239" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-240"><a href="#cb31-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-241"><a href="#cb31-241" aria-hidden="true" tabindex="-1"></a>::: {#exm-}</span>
<span id="cb31-242"><a href="#cb31-242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-243"><a href="#cb31-243" aria-hidden="true" tabindex="-1"></a><span class="fu">## Increasing p</span></span>
<span id="cb31-244"><a href="#cb31-244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-245"><a href="#cb31-245" aria-hidden="true" tabindex="-1"></a>What happens if we let $p$ get arbitrarily large? Let's plot $\norm{\x}_p$ for various values of $\x$.</span>
<span id="cb31-246"><a href="#cb31-246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-249"><a href="#cb31-249" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb31-250"><a href="#cb31-250" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb31-251"><a href="#cb31-251" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-align: center</span></span>
<span id="cb31-252"><a href="#cb31-252" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-asp: 1</span></span>
<span id="cb31-253"><a href="#cb31-253" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 11</span></span>
<span id="cb31-254"><a href="#cb31-254" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Distribution of estimators for the population variance"</span></span>
<span id="cb31-255"><a href="#cb31-255" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Show code which generates figure"</span></span>
<span id="cb31-256"><a href="#cb31-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-257"><a href="#cb31-257" aria-hidden="true" tabindex="-1"></a>p_norm <span class="ot">&lt;-</span> <span class="cf">function</span>(p, x){</span>
<span id="cb31-258"><a href="#cb31-258" aria-hidden="true" tabindex="-1"></a>  (<span class="fu">sum</span>(<span class="fu">abs</span>(x)<span class="sc">^</span>p))<span class="sc">^</span>(<span class="dv">1</span><span class="sc">/</span>p)</span>
<span id="cb31-259"><a href="#cb31-259" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-260"><a href="#cb31-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-261"><a href="#cb31-261" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">x1 =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb31-262"><a href="#cb31-262" aria-hidden="true" tabindex="-1"></a>       <span class="at">x2 =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>),</span>
<span id="cb31-263"><a href="#cb31-263" aria-hidden="true" tabindex="-1"></a>       <span class="at">x3 =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">3</span>, <span class="dv">3</span>),</span>
<span id="cb31-264"><a href="#cb31-264" aria-hidden="true" tabindex="-1"></a>       <span class="at">x4 =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="sc">-</span><span class="dv">4</span>)</span>
<span id="cb31-265"><a href="#cb31-265" aria-hidden="true" tabindex="-1"></a>       ) <span class="sc">%&gt;%</span> </span>
<span id="cb31-266"><a href="#cb31-266" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">vector =</span> <span class="fu">ifelse</span>(x4 <span class="sc">==</span> <span class="sc">-</span><span class="dv">4</span>, <span class="st">"x = (1,2,3,-4)"</span>, <span class="fu">ifelse</span>(x3 <span class="sc">==</span> <span class="dv">3</span>, <span class="st">"x = (1,2,3)"</span>, <span class="fu">ifelse</span>(x2 <span class="sc">==</span> <span class="dv">2</span>, <span class="st">"x = (1,2)"</span>, <span class="st">"x = 1"</span>))))  <span class="sc">%&gt;%</span> </span>
<span id="cb31-267"><a href="#cb31-267" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand_grid</span>(<span class="at">p =</span> <span class="fu">seq</span>(<span class="dv">1</span>,<span class="dv">10</span>, <span class="at">length =</span> <span class="dv">100</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb31-268"><a href="#cb31-268" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb31-269"><a href="#cb31-269" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">norm =</span> <span class="fu">p_norm</span>(p, <span class="fu">c</span>(x1, x2, x3, x4))) <span class="sc">%&gt;%</span> </span>
<span id="cb31-270"><a href="#cb31-270" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(p, norm)) <span class="sc">+</span></span>
<span id="cb31-271"><a href="#cb31-271" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span> </span>
<span id="cb31-272"><a href="#cb31-272" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>vector, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb31-273"><a href="#cb31-273" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb31-274"><a href="#cb31-274" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"p"</span>, <span class="at">y =</span> <span class="st">"p-norm"</span>)</span>
<span id="cb31-275"><a href="#cb31-275" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-276"><a href="#cb31-276" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb31-277"><a href="#cb31-277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-278"><a href="#cb31-278" aria-hidden="true" tabindex="-1"></a>An interesting pattern comes to light -- it appears that as $p \to \infty$, $\norm{\x}_p$ approaches the largest possible value of $\abs{x_i}$. </span>
<span id="cb31-279"><a href="#cb31-279" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-280"><a href="#cb31-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-281"><a href="#cb31-281" aria-hidden="true" tabindex="-1"></a>As this example hints at, </span>
<span id="cb31-282"><a href="#cb31-282" aria-hidden="true" tabindex="-1"></a>$$\norm{\x}_{\infty} = \max_{x_i}\abs{x_i}.$$ As we let $p\to\infty$, we put increasingly more weight on the components $x_i$ which have the largest distance from $0$ in their dimension. Eventually, $p$ becomes so large that the contribution of $\left(\max_{x_i}\abs{x_i}\right)^p$ to the sum dwarfs those of the other components, and we end up with something which is practically $\max_{x_i}\abs{x_i}$ after taking the $p$-th root of the sum. The result of this limiting process gives $\norm{\x}_\infty$. An excellent way to illustrate this is by graphing the set $\{\x\in \R^2 \mid \norm{\x}_p = 1\}$, i.e the boundary of the unit ball in $\R^2$ equipped with $\norm{\cdot}_p$.</span>
<span id="cb31-283"><a href="#cb31-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-286"><a href="#cb31-286" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb31-287"><a href="#cb31-287" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb31-288"><a href="#cb31-288" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-align: center</span></span>
<span id="cb31-289"><a href="#cb31-289" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-plot531243</span></span>
<span id="cb31-290"><a href="#cb31-290" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-asp: 0.5</span></span>
<span id="cb31-291"><a href="#cb31-291" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 1</span></span>
<span id="cb31-292"><a href="#cb31-292" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "test"</span></span>
<span id="cb31-293"><a href="#cb31-293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-294"><a href="#cb31-294" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">"figures/lp_norm.png"</span>)</span>
<span id="cb31-295"><a href="#cb31-295" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb31-296"><a href="#cb31-296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-297"><a href="#cb31-297" aria-hidden="true" tabindex="-1"></a>So what does this all have to do with statistics and econometrics? Quite a bit if you consider the important role loss functions play in estimation. For a scalar estimator $\hat \theta$, the quadratic loss function $l(\hat\theta,\theta) = (\hat\theta - \theta)^2$ gave the special risk function known as mean square error. </span>
<span id="cb31-298"><a href="#cb31-298" aria-hidden="true" tabindex="-1"></a>$$ \mse{\hat \theta }= \E{(\hat\theta - \theta)^2}.$$</span>
<span id="cb31-299"><a href="#cb31-299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-300"><a href="#cb31-300" aria-hidden="true" tabindex="-1"></a>If $\hat{\thet}$ is a vector, then we can write $\mse{\hat{\thet}}$ in terms of $\norm{\cdot}_2$. </span>
<span id="cb31-301"><a href="#cb31-301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-302"><a href="#cb31-302" aria-hidden="true" tabindex="-1"></a>$$\mse{\hat{ \thet} }= \E{\textstyle\sum_{i=1}^n(\hat\theta_i - \theta_i)^2} = \E{\norm{\hat{\thet} - \thet}_2^2}.$$</span>
<span id="cb31-303"><a href="#cb31-303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-304"><a href="#cb31-304" aria-hidden="true" tabindex="-1"></a>In general, you're welcome to define a risk function using the $p$-norm for any value of $p$, and there may be situations which call for this depending on which components of $\hat{\thet}$ are deemed important.</span>
<span id="cb31-305"><a href="#cb31-305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-306"><a href="#cb31-306" aria-hidden="true" tabindex="-1"></a>$$R(\hat{\thet}, \thet) = \E{\norm{\hat{\thet} - \thet}_p^p}$$</span>
<span id="cb31-307"><a href="#cb31-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-308"><a href="#cb31-308" aria-hidden="true" tabindex="-1"></a>Now we're ready to extend this to vector spaces of functions. Suppose $\mathcal F$ is a vector space of real valued functions $f:\R^n\to\R$. For the sake of ease, let's also assume all of these functions are continuous and bounded. In this case, $f$ is defined at an uncountably infinite number of points, so we cannot possibly sum over values of $\abs{f(\x)}^p$ for all $\x\in\R$. Instead we'll have to integrate over $\x$. This gives </span>
<span id="cb31-309"><a href="#cb31-309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-310"><a href="#cb31-310" aria-hidden="true" tabindex="-1"></a>$$\norm{f}_p =\left(\int_{-\infty}^\infty \abs{f(\x)}^p\ d\x \right)^{1/p}.$$</span>
<span id="cb31-311"><a href="#cb31-311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-312"><a href="#cb31-312" aria-hidden="true" tabindex="-1"></a>Just like in the case of Euclidean space, the $p-$norm also endows $\mathcal F$ with a metric that measures the distance between two functions which belong to $\mathcal F$.</span>
<span id="cb31-313"><a href="#cb31-313" aria-hidden="true" tabindex="-1"></a>$$ \norm{f - g}_p =\left(\int_{-\infty}^\infty \abs{f(\x) - g(\x)}^p\ d\x \right)^{1/p}$$</span>
<span id="cb31-314"><a href="#cb31-314" aria-hidden="true" tabindex="-1"></a>For $f\in \mathcal F$ we have </span>
<span id="cb31-315"><a href="#cb31-315" aria-hidden="true" tabindex="-1"></a>$$ \norm{f}_\infty = \sup_{\x \in \R^n}\abs{f(\x)},$$ where we take the supremum instead of maximum to account for the possibility that as $p\to\infty$  $\max_{\x \in \R^n}\abs{f(\x)}$ may approach a limit whose value it never takes on. This norm is particularly important because the role it plays in the convergence of sequences of functions. If we have a sequence of functions $f_n$, then $f_n$ converges to $f$ uniformly if and only if </span>
<span id="cb31-316"><a href="#cb31-316" aria-hidden="true" tabindex="-1"></a>$$ \lim_{n\to\infty}\norm{f_n - f}_\infty = 0.$$ For this reason, the supremum norm is also known as the "uniform norm". </span>
<span id="cb31-317"><a href="#cb31-317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-318"><a href="#cb31-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-319"><a href="#cb31-319" aria-hidden="true" tabindex="-1"></a>All of this can be defined for general vector spaces of functions, and not just the space of real valued functions which are bounded and continuous. It's also possible to unify the separate discussions of $\norm{\cdot}_p$ on Euclidean space and $\norm{\cdot}_p$ on function spaces using a bit of measure theory.^<span class="co">[</span><span class="ot">These spaces both are special cases of what is known as an $L^p$ space, with $L^2$ being of particularly interest because it is the only $L^p$ space that is a Hilbert space.</span><span class="co">]</span></span>
<span id="cb31-320"><a href="#cb31-320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-321"><a href="#cb31-321" aria-hidden="true" tabindex="-1"></a><span class="fu">## Estimating a Distribution</span></span>
<span id="cb31-322"><a href="#cb31-322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-323"><a href="#cb31-323" aria-hidden="true" tabindex="-1"></a>We'll start with the task of developing an estimator $\hat F_X$ for a random variable's distribution function $X$. The distribution $F_X$ is defined as $$F_X(t) = \Pr(X \le t),$$ so all we are doing is estimating a probability for all possible values of $x \in \mathcal X$. If that sounds easy, it's because it is. We can just look at the proportion of observations which are less than or equal to $t,$ and take this to be $\Pr(X \le t)$. </span>
<span id="cb31-324"><a href="#cb31-324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-325"><a href="#cb31-325" aria-hidden="true" tabindex="-1"></a>$$\hat F_X(t) = \frac{\text{number of observations} \le t}{\text{number of observations}}.$$</span>
<span id="cb31-326"><a href="#cb31-326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-327"><a href="#cb31-327" aria-hidden="true" tabindex="-1"></a>::: {#def-}</span>
<span id="cb31-328"><a href="#cb31-328" aria-hidden="true" tabindex="-1"></a>Given an IID sample of size $n$ of a random variable $X$, the <span class="kw">&lt;span</span> <span class="er">style</span><span class="ot">=</span><span class="st">"color:red"</span><span class="kw">&gt;</span>**_empirical (cumulative) distribution function (eCDF)_**<span class="kw">&lt;/span&gt;</span> is defined as </span>
<span id="cb31-329"><a href="#cb31-329" aria-hidden="true" tabindex="-1"></a>$$\hat F_X(t) = \frac{1}{n}\sum_{i=1}^n I\left<span class="co">[</span><span class="ot">X_i \le t\right</span><span class="co">]</span>.$$</span>
<span id="cb31-330"><a href="#cb31-330" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-331"><a href="#cb31-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-332"><a href="#cb31-332" aria-hidden="true" tabindex="-1"></a>::: {#exm-}</span>
<span id="cb31-333"><a href="#cb31-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-334"><a href="#cb31-334" aria-hidden="true" tabindex="-1"></a>Let's calculate $\hat F_X$ for our mixed normal distribution using a sample of size $n = 100$. </span>
<span id="cb31-335"><a href="#cb31-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-338"><a href="#cb31-338" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb31-339"><a href="#cb31-339" aria-hidden="true" tabindex="-1"></a>emp_dist <span class="ot">&lt;-</span> <span class="cf">function</span>(sample, t){</span>
<span id="cb31-340"><a href="#cb31-340" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">length</span>(sample)</span>
<span id="cb31-341"><a href="#cb31-341" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sum</span>(sample <span class="sc">&lt;=</span> t)<span class="sc">/</span>n</span>
<span id="cb31-342"><a href="#cb31-342" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-343"><a href="#cb31-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-344"><a href="#cb31-344" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb31-345"><a href="#cb31-345" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">draw_X</span>(n)</span>
<span id="cb31-346"><a href="#cb31-346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-347"><a href="#cb31-347" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate the estimate by calculating values on approximate support </span></span>
<span id="cb31-348"><a href="#cb31-348" aria-hidden="true" tabindex="-1"></a>F_hat <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="fu">seq</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">12</span>, <span class="at">length =</span> <span class="fl">1e5</span>), emp_dist, <span class="at">sample =</span> X)</span>
<span id="cb31-349"><a href="#cb31-349" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb31-350"><a href="#cb31-350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-351"><a href="#cb31-351" aria-hidden="true" tabindex="-1"></a>Now let's plot the estimated distribution and contrast it with the versus the true distribution. </span>
<span id="cb31-352"><a href="#cb31-352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-355"><a href="#cb31-355" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb31-356"><a href="#cb31-356" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb31-357"><a href="#cb31-357" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-plot412e1712</span></span>
<span id="cb31-358"><a href="#cb31-358" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-align: center</span></span>
<span id="cb31-359"><a href="#cb31-359" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-asp: 0.7</span></span>
<span id="cb31-360"><a href="#cb31-360" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 8</span></span>
<span id="cb31-361"><a href="#cb31-361" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: " "</span></span>
<span id="cb31-362"><a href="#cb31-362" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Show code which generates figure"</span></span>
<span id="cb31-363"><a href="#cb31-363" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">12</span>, <span class="at">length =</span> <span class="fl">1e5</span>), <span class="st">`</span><span class="at">Empirical Distribution</span><span class="st">`</span> <span class="ot">=</span> F_hat) <span class="sc">%&gt;%</span> </span>
<span id="cb31-364"><a href="#cb31-364" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">True Distribution</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">F_X</span>(x)) <span class="sc">%&gt;%</span> </span>
<span id="cb31-365"><a href="#cb31-365" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gather</span>(<span class="st">"func"</span>, <span class="st">"prob"</span>, <span class="sc">-</span>x) <span class="sc">%&gt;%</span> </span>
<span id="cb31-366"><a href="#cb31-366" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(x, prob, <span class="at">color =</span> func)) <span class="sc">+</span> </span>
<span id="cb31-367"><a href="#cb31-367" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb31-368"><a href="#cb31-368" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"black"</span>, <span class="st">"red"</span>)) <span class="sc">+</span></span>
<span id="cb31-369"><a href="#cb31-369" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"t"</span>, <span class="at">color =</span> <span class="st">""</span>, <span class="at">y =</span> <span class="st">"Pr(X &lt;= t)"</span>)  <span class="sc">+</span></span>
<span id="cb31-370"><a href="#cb31-370" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb31-371"><a href="#cb31-371" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>) </span>
<span id="cb31-372"><a href="#cb31-372" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb31-373"><a href="#cb31-373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-374"><a href="#cb31-374" aria-hidden="true" tabindex="-1"></a>By construction, $\hat F_X(x)$ is a discontinuous step function because it is the sum of discontinuous indicator functions. Nevertheless, $\hat F_X$ looks pretty close to $F_X$! </span>
<span id="cb31-375"><a href="#cb31-375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-376"><a href="#cb31-376" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-377"><a href="#cb31-377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-378"><a href="#cb31-378" aria-hidden="true" tabindex="-1"></a><span class="fu">## Properties of the Empirical Distribution</span></span>
<span id="cb31-379"><a href="#cb31-379" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-380"><a href="#cb31-380" aria-hidden="true" tabindex="-1"></a><span class="fu">### Pointwise Properties </span></span>
<span id="cb31-381"><a href="#cb31-381" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-382"><a href="#cb31-382" aria-hidden="true" tabindex="-1"></a>The challenge of determining the properties of $\hat F_X$ comes from it being an entire function opposed to a single value. Let's start with an easier task by reframing the problem to consider $\hat F_X$ *evaluated* at some fixed point $x_0$. That is, what are the *pointwise* properties of $\hat F_X(x_0)$? </span>
<span id="cb31-383"><a href="#cb31-383" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-384"><a href="#cb31-384" aria-hidden="true" tabindex="-1"></a>First, let's consider the bias of $\hat F_X(x_0)$. The empirical distribution function is a linear combination of indicator functions, so taking its expectation is straightforward.</span>
<span id="cb31-385"><a href="#cb31-385" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb31-386"><a href="#cb31-386" aria-hidden="true" tabindex="-1"></a>\E{\hat F_X(x_0)} &amp; = \E{\frac{1}{n}\sum_{i=1}^n I\left<span class="co">[</span><span class="ot">X_i \le x_0\right</span><span class="co">]</span>}<span class="sc">\\</span></span>
<span id="cb31-387"><a href="#cb31-387" aria-hidden="true" tabindex="-1"></a>&amp; = \frac{1}{n}\sum_{i=1}^n \E{I\left<span class="co">[</span><span class="ot">X_i \le x_0\right</span><span class="co">]</span>}<span class="sc">\\</span></span>
<span id="cb31-388"><a href="#cb31-388" aria-hidden="true" tabindex="-1"></a>&amp; = \frac{1}{n}\sum_{i=1}^n 1\cdot \Pr(X_i \le x_0) + 0\cdot \Pr(X_i &gt; x_0) &amp; (\text{definition of indicator})<span class="sc">\\</span></span>
<span id="cb31-389"><a href="#cb31-389" aria-hidden="true" tabindex="-1"></a>&amp; = \frac{1}{n}\left(n\cdot  \Pr(X_i \le x_0)\right)<span class="sc">\\</span></span>
<span id="cb31-390"><a href="#cb31-390" aria-hidden="true" tabindex="-1"></a>&amp; =  \Pr(X_i \le x_0)<span class="sc">\\</span></span>
<span id="cb31-391"><a href="#cb31-391" aria-hidden="true" tabindex="-1"></a>&amp; = F_X(x_0)</span>
<span id="cb31-392"><a href="#cb31-392" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb31-393"><a href="#cb31-393" aria-hidden="true" tabindex="-1"></a>The estimator, as perhaps anticipated, is unbiased. Now let's calculate its variance. </span>
<span id="cb31-394"><a href="#cb31-394" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb31-395"><a href="#cb31-395" aria-hidden="true" tabindex="-1"></a>\var{\hat F_X(x_0)} &amp; = \var{\frac{1}{n}\sum_{i=1}^n I\left<span class="co">[</span><span class="ot">X_i \le x_0\right</span><span class="co">]</span>}<span class="sc">\\</span></span>
<span id="cb31-396"><a href="#cb31-396" aria-hidden="true" tabindex="-1"></a>&amp; = \frac{1}{n^2} \sum_{i=1}^n \left<span class="sc">\{</span>\E{I\left<span class="co">[</span><span class="ot">X_i \le x_0\right</span><span class="co">]</span>^2} - \left(\E{I\left<span class="co">[</span><span class="ot">X_i \le x_0\right</span><span class="co">]</span>}\right)^2\right<span class="sc">\}\\</span></span>
<span id="cb31-397"><a href="#cb31-397" aria-hidden="true" tabindex="-1"></a>&amp; = \frac{1}{n^2} \sum_{i=1}^n \left<span class="sc">\{</span>\E{I\left<span class="co">[</span><span class="ot">X_i \le x_0\right</span><span class="co">]</span>} - \left(\E{I\left<span class="co">[</span><span class="ot">X_i \le x_0\right</span><span class="co">]</span>}\right)^2\right<span class="sc">\}</span> &amp; (I\left<span class="co">[</span><span class="ot">X_i \le x_0\right</span><span class="co">]</span>^2 = I\left<span class="co">[</span><span class="ot">X_i \le x_0\right</span><span class="co">]</span>)<span class="sc">\\</span></span>
<span id="cb31-398"><a href="#cb31-398" aria-hidden="true" tabindex="-1"></a>&amp; = \frac{1}{n^2} \sum_{i=1}^n \left<span class="co">[</span><span class="ot">\Pr(X_i \le x_0) - \Pr(X_i \le x_0)^2\right</span><span class="co">]</span> &amp; (\E{I\left<span class="co">[</span><span class="ot">X_i \le x_0\right</span><span class="co">]</span>} = \Pr(X_i \le x_0))<span class="sc">\\</span></span>
<span id="cb31-399"><a href="#cb31-399" aria-hidden="true" tabindex="-1"></a>&amp; = \frac{1}{n^2}<span class="co">[</span><span class="ot">n\Pr(X_i \le x_0)(1- \Pr(X_i \le x_0))</span><span class="co">]</span><span class="sc">\\</span></span>
<span id="cb31-400"><a href="#cb31-400" aria-hidden="true" tabindex="-1"></a>&amp; = \frac{F_X(x_0)(1-F_X(x_0))}{n}</span>
<span id="cb31-401"><a href="#cb31-401" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb31-402"><a href="#cb31-402" aria-hidden="true" tabindex="-1"></a>If calculating the expectation and variance of $\hat F_X(x_0)$ feels "familiar", that may be because we've just calculated the expected value and variance of a binomial random variable. Define $Y = n\hat F_X(x)$ such that $$ Y = \sum_{i=1}^n I\left<span class="co">[</span><span class="ot">X_i \le x_0\right</span><span class="co">]</span>.$$ The random variable $Y$ is the sum of $n$ Bernoulli trials, each with succeeding with probability $\Pr(X_i \le x_0) = F_X(x_0)$, meaning $Y \sim \text{Bernoulli}(n, F_X(x_0))$. As such, we can just appeal to the expected value and variance of $Y$ to calculate the corresponding moments for $\hat F_X(x)$.</span>
<span id="cb31-403"><a href="#cb31-403" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb31-404"><a href="#cb31-404" aria-hidden="true" tabindex="-1"></a>\E{\hat F_X(x)} &amp; = \E{\frac{1}{n}Y} = \frac{1}{n}\left(nF_X(x_0)\right) = F_X(x_0)<span class="sc">\\</span></span>
<span id="cb31-405"><a href="#cb31-405" aria-hidden="true" tabindex="-1"></a>\var{\hat F_X(x)} &amp; = \var{\frac{1}{n}Y} = \frac{1}{n^2}\left(nF_X(x_0)(1-F_X(x_0))\right) = \frac{F_X(x_0)(1-F_X(x_0))}{n}</span>
<span id="cb31-406"><a href="#cb31-406" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb31-407"><a href="#cb31-407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-408"><a href="#cb31-408" aria-hidden="true" tabindex="-1"></a>Noting that $\lim_{n\to\infty}\var{\hat F_X(x_0)} = 0$, @cor-unbcon establishes that $\hat F_X(x_0)$ is consistent. </span>
<span id="cb31-409"><a href="#cb31-409" aria-hidden="true" tabindex="-1"></a>$$ \hat F_X(x_0) \pto F_X(x_0)$$</span>
<span id="cb31-410"><a href="#cb31-410" aria-hidden="true" tabindex="-1"></a>Finally, because $\hat F_X(x_0)$ is the average of independent Bernoulli trials, so we can apply the CLT to conclude that $\sqrt n<span class="co">[</span><span class="ot">\hat F_X(x_0)-  F_X(x_0)</span><span class="co">]</span> \dto N(0, F_X(x_0)(1-F_X(x_0)))$.</span>
<span id="cb31-411"><a href="#cb31-411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-412"><a href="#cb31-412" aria-hidden="true" tabindex="-1"></a>::: {#thm-}</span>
<span id="cb31-413"><a href="#cb31-413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-414"><a href="#cb31-414" aria-hidden="true" tabindex="-1"></a><span class="fu">## Pointwise Properties of Empirical Distribution</span></span>
<span id="cb31-415"><a href="#cb31-415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-416"><a href="#cb31-416" aria-hidden="true" tabindex="-1"></a>The empirical distribution function $\hat F_X(x_0)$, *evaluated at a fixed point* $x_0$, exhibits the following properties:</span>
<span id="cb31-417"><a href="#cb31-417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-418"><a href="#cb31-418" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Unbiasedness, $\E{\hat F_X(x_0)} = F_X(x_0)$;</span>
<span id="cb31-419"><a href="#cb31-419" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>$\var{\hat F_X(x_0)} = \frac{F_X(x_0)(1-F_X(x_0))}{n}$;</span>
<span id="cb31-420"><a href="#cb31-420" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Consistency,  $\hat F_X(x_0) \pto F_X(x_0)$;</span>
<span id="cb31-421"><a href="#cb31-421" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>Asymptotic Normality, $\hat F_X(x_0) \asim N(0, F_X(x_0)(1-F_X(x_0))/n)$.</span>
<span id="cb31-422"><a href="#cb31-422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-423"><a href="#cb31-423" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-424"><a href="#cb31-424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-425"><a href="#cb31-425" aria-hidden="true" tabindex="-1"></a>::: {#exm-}</span>
<span id="cb31-426"><a href="#cb31-426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-427"><a href="#cb31-427" aria-hidden="true" tabindex="-1"></a>To illustrate these properties, let's simulate the estimation of $F_X(0)$ where $X$ is distributed according to the mixed normal distribution we've been using. First, let's see what the true value of $F_X(X_0)$ is, along with $F_X(X_0)(1-F_X(X_0))/n$. </span>
<span id="cb31-428"><a href="#cb31-428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-431"><a href="#cb31-431" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb31-432"><a href="#cb31-432" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb31-433"><a href="#cb31-433" aria-hidden="true" tabindex="-1"></a>x_0 <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb31-434"><a href="#cb31-434" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-435"><a href="#cb31-435" aria-hidden="true" tabindex="-1"></a><span class="fu">F_X</span>(x_0)</span>
<span id="cb31-436"><a href="#cb31-436" aria-hidden="true" tabindex="-1"></a>(<span class="dv">1</span> <span class="sc">-</span> <span class="fu">F_X</span>(x_0))<span class="sc">*</span><span class="fu">F_X</span>(x_0)<span class="sc">/</span>n</span>
<span id="cb31-437"><a href="#cb31-437" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb31-438"><a href="#cb31-438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-439"><a href="#cb31-439" aria-hidden="true" tabindex="-1"></a>For our first simulations, we'll simulate one million estimates using samples of size $n = 1,000$. </span>
<span id="cb31-440"><a href="#cb31-440" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-443"><a href="#cb31-443" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb31-444"><a href="#cb31-444" aria-hidden="true" tabindex="-1"></a>N_sim <span class="ot">&lt;-</span> <span class="fl">1e6</span></span>
<span id="cb31-445"><a href="#cb31-445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-446"><a href="#cb31-446" aria-hidden="true" tabindex="-1"></a>estimates <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">"numeric"</span>, <span class="at">length =</span> N_sim)</span>
<span id="cb31-447"><a href="#cb31-447" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>N_sim) {</span>
<span id="cb31-448"><a href="#cb31-448" aria-hidden="true" tabindex="-1"></a>  X <span class="ot">&lt;-</span> <span class="fu">draw_X</span>(n)</span>
<span id="cb31-449"><a href="#cb31-449" aria-hidden="true" tabindex="-1"></a>  estimates[k] <span class="ot">&lt;-</span> <span class="fu">emp_dist</span>(X, x_0)</span>
<span id="cb31-450"><a href="#cb31-450" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-451"><a href="#cb31-451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-452"><a href="#cb31-452" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(estimates)</span>
<span id="cb31-453"><a href="#cb31-453" aria-hidden="true" tabindex="-1"></a><span class="fu">var</span>(estimates)</span>
<span id="cb31-454"><a href="#cb31-454" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb31-455"><a href="#cb31-455" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-456"><a href="#cb31-456" aria-hidden="true" tabindex="-1"></a>The simulated expectation and variance are in line with our calculations. Let's now look at the histogram of our values compared with the theoretical limiting distribution.</span>
<span id="cb31-457"><a href="#cb31-457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-460"><a href="#cb31-460" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb31-461"><a href="#cb31-461" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb31-462"><a href="#cb31-462" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-plot412e171212</span></span>
<span id="cb31-463"><a href="#cb31-463" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-align: center</span></span>
<span id="cb31-464"><a href="#cb31-464" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-asp: 0.7</span></span>
<span id="cb31-465"><a href="#cb31-465" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 8</span></span>
<span id="cb31-466"><a href="#cb31-466" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: " "</span></span>
<span id="cb31-467"><a href="#cb31-467" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Show code which generates figure"</span></span>
<span id="cb31-468"><a href="#cb31-468" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(estimates) <span class="sc">%&gt;%</span> </span>
<span id="cb31-469"><a href="#cb31-469" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(estimates)) <span class="sc">+</span></span>
<span id="cb31-470"><a href="#cb31-470" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">y =</span> ..density..), <span class="at">fill =</span> <span class="st">"white"</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">binwidth =</span> .<span class="dv">01</span>) <span class="sc">+</span></span>
<span id="cb31-471"><a href="#cb31-471" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_function</span>(<span class="at">fun =</span> dnorm, <span class="at">args =</span> <span class="fu">list</span>(<span class="at">mean =</span> <span class="fu">F_X</span>(x_0), <span class="at">sd =</span> <span class="fu">sqrt</span>((<span class="dv">1</span> <span class="sc">-</span> <span class="fu">F_X</span>(x_0))<span class="sc">*</span><span class="fu">F_X</span>(x_0)<span class="sc">/</span>n)), <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb31-472"><a href="#cb31-472" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb31-473"><a href="#cb31-473" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Empirical Distribution Evaluated at 0"</span>, <span class="at">y =</span> <span class="st">"Density"</span>)</span>
<span id="cb31-474"><a href="#cb31-474" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb31-475"><a href="#cb31-475" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-476"><a href="#cb31-476" aria-hidden="true" tabindex="-1"></a>A second set of simulations for varying sample sizes can illustrate consistency.</span>
<span id="cb31-477"><a href="#cb31-477" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-478"><a href="#cb31-478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-481"><a href="#cb31-481" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb31-482"><a href="#cb31-482" aria-hidden="true" tabindex="-1"></a>N_sim <span class="ot">&lt;-</span> <span class="fl">1e4</span></span>
<span id="cb31-483"><a href="#cb31-483" aria-hidden="true" tabindex="-1"></a>estimates <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">"numeric"</span>, <span class="at">length =</span> N_sim)</span>
<span id="cb31-484"><a href="#cb31-484" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (n <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>N_sim) {</span>
<span id="cb31-485"><a href="#cb31-485" aria-hidden="true" tabindex="-1"></a>  X <span class="ot">&lt;-</span> <span class="fu">draw_X</span>(n)</span>
<span id="cb31-486"><a href="#cb31-486" aria-hidden="true" tabindex="-1"></a>  estimates[n] <span class="ot">&lt;-</span> <span class="fu">emp_dist</span>(X, x_0) </span>
<span id="cb31-487"><a href="#cb31-487" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-488"><a href="#cb31-488" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb31-489"><a href="#cb31-489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-492"><a href="#cb31-492" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb31-493"><a href="#cb31-493" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb31-494"><a href="#cb31-494" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-plot412e171123</span></span>
<span id="cb31-495"><a href="#cb31-495" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-align: center</span></span>
<span id="cb31-496"><a href="#cb31-496" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-asp: 0.7</span></span>
<span id="cb31-497"><a href="#cb31-497" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 8</span></span>
<span id="cb31-498"><a href="#cb31-498" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: " "</span></span>
<span id="cb31-499"><a href="#cb31-499" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Show code which generates figure"</span></span>
<span id="cb31-500"><a href="#cb31-500" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">n =</span> <span class="dv">1</span><span class="sc">:</span>N_sim, estimates) <span class="sc">%&gt;%</span> </span>
<span id="cb31-501"><a href="#cb31-501" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(n, estimates)) <span class="sc">+</span></span>
<span id="cb31-502"><a href="#cb31-502" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb31-503"><a href="#cb31-503" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">F_X</span>(x_0), <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb31-504"><a href="#cb31-504" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Empirical Distribution Evaluated at 0"</span>, <span class="at">x =</span> <span class="st">"Sample Size, n"</span>) <span class="sc">+</span></span>
<span id="cb31-505"><a href="#cb31-505" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb31-506"><a href="#cb31-506" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb31-507"><a href="#cb31-507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-508"><a href="#cb31-508" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-509"><a href="#cb31-509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-510"><a href="#cb31-510" aria-hidden="true" tabindex="-1"></a>::: {#exm-}</span>
<span id="cb31-511"><a href="#cb31-511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-512"><a href="#cb31-512" aria-hidden="true" tabindex="-1"></a><span class="fu">## Confidence Intervals</span></span>
<span id="cb31-513"><a href="#cb31-513" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-514"><a href="#cb31-514" aria-hidden="true" tabindex="-1"></a>It's possible to construct pointwise confidence intervals using the fact that $\hat F_X(x_0) \asim N(0, F_X(x_0)(1-F_X(x_0))/n)$. A level $(1-\alpha)$ confidence interval for $F_X(x_0)$ would be given by </span>
<span id="cb31-515"><a href="#cb31-515" aria-hidden="true" tabindex="-1"></a>$$ \left<span class="co">[</span><span class="ot">\hat F_X(x_0) - \Phi^{-1}(1-\alpha/2)\sqrt{\frac{\hat F_X(x_0)(1-\hat F_X(x_0))}{n}}, \hat F_X(x_0) + \Phi^{-1}(1-\alpha/2)\sqrt{ \frac{\hat F_X(x_0)(1-\hat F_X(x_0))}{n}}\right</span><span class="co">]</span>.$$ If we want to construct these intervals for multiple values of $F_X(x_0)$, we need to be careful because they're pointwise. For the sake of illustration, let's construct these confidence intervals (taking $\alpha=0.05$) over the support of $F_X$ and graph our results.</span>
<span id="cb31-516"><a href="#cb31-516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-519"><a href="#cb31-519" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb31-520"><a href="#cb31-520" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb31-521"><a href="#cb31-521" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">draw_X</span>(n)</span>
<span id="cb31-522"><a href="#cb31-522" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-523"><a href="#cb31-523" aria-hidden="true" tabindex="-1"></a>CI <span class="ot">&lt;-</span> <span class="cf">function</span>(a, sample, t){</span>
<span id="cb31-524"><a href="#cb31-524" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">length</span>(sample)</span>
<span id="cb31-525"><a href="#cb31-525" aria-hidden="true" tabindex="-1"></a>  F_hat <span class="ot">&lt;-</span> <span class="fu">emp_dist</span>(sample, t)</span>
<span id="cb31-526"><a href="#cb31-526" aria-hidden="true" tabindex="-1"></a>  lower <span class="ot">&lt;-</span> F_hat  <span class="sc">-</span> <span class="fu">qnorm</span>(<span class="dv">1</span> <span class="sc">-</span> a<span class="sc">/</span><span class="dv">2</span>)<span class="sc">*</span><span class="fu">sqrt</span>((F_hat<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>F_hat))<span class="sc">/</span>n)</span>
<span id="cb31-527"><a href="#cb31-527" aria-hidden="true" tabindex="-1"></a>  upper <span class="ot">&lt;-</span> F_hat  <span class="sc">+</span> <span class="fu">qnorm</span>(<span class="dv">1</span> <span class="sc">-</span> a<span class="sc">/</span><span class="dv">2</span>)<span class="sc">*</span><span class="fu">sqrt</span>((F_hat<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>F_hat))<span class="sc">/</span>n)</span>
<span id="cb31-528"><a href="#cb31-528" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">c</span>(lower, upper))</span>
<span id="cb31-529"><a href="#cb31-529" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-530"><a href="#cb31-530" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-531"><a href="#cb31-531" aria-hidden="true" tabindex="-1"></a>F_hat <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="fu">seq</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">12</span>, <span class="at">length =</span> <span class="fl">1e5</span>), emp_dist, <span class="at">sample =</span> X)</span>
<span id="cb31-532"><a href="#cb31-532" aria-hidden="true" tabindex="-1"></a>F_CI <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="fu">seq</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">12</span>, <span class="at">length =</span> <span class="fl">1e5</span>), CI, <span class="at">a =</span> <span class="fl">0.05</span>, <span class="at">sample =</span> X)</span>
<span id="cb31-533"><a href="#cb31-533" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb31-534"><a href="#cb31-534" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb31-535"><a href="#cb31-535" aria-hidden="true" tabindex="-1"></a>Let's plot our confidence intervals along the support of $F_X$.</span>
<span id="cb31-536"><a href="#cb31-536" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb31-539"><a href="#cb31-539" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb31-540"><a href="#cb31-540" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb31-541"><a href="#cb31-541" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb31-542"><a href="#cb31-542" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-plot412e17190</span></span>
<span id="cb31-543"><a href="#cb31-543" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-align: center</span></span>
<span id="cb31-544"><a href="#cb31-544" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-asp: 0.7</span></span>
<span id="cb31-545"><a href="#cb31-545" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 8</span></span>
<span id="cb31-546"><a href="#cb31-546" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: " "</span></span>
<span id="cb31-547"><a href="#cb31-547" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Show code which generates figure"</span></span>
<span id="cb31-548"><a href="#cb31-548" aria-hidden="true" tabindex="-1"></a><span class="fu">t</span>(F_CI) <span class="sc">%&gt;%</span> </span>
<span id="cb31-549"><a href="#cb31-549" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb31-550"><a href="#cb31-550" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb31-551"><a href="#cb31-551" aria-hidden="true" tabindex="-1"></a>    <span class="at">lower =</span> V1,</span>
<span id="cb31-552"><a href="#cb31-552" aria-hidden="true" tabindex="-1"></a>    <span class="at">upper =</span> V2</span>
<span id="cb31-553"><a href="#cb31-553" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb31-554"><a href="#cb31-554" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb31-555"><a href="#cb31-555" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">12</span>, <span class="at">length =</span> <span class="fl">1e5</span>),</span>
<span id="cb31-556"><a href="#cb31-556" aria-hidden="true" tabindex="-1"></a>    <span class="at">F_hat =</span> F_hat</span>
<span id="cb31-557"><a href="#cb31-557" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb31-558"><a href="#cb31-558" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(x, F_hat)) <span class="sc">+</span> </span>
<span id="cb31-559"><a href="#cb31-559" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> <span class="st">"Empirical Distribution"</span>)) <span class="sc">+</span></span>
<span id="cb31-560"><a href="#cb31-560" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> lower, <span class="at">ymax =</span> upper, <span class="at">fill =</span> <span class="st">"95% (Pointwise) Confidence Interval"</span>), <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb31-561"><a href="#cb31-561" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb31-562"><a href="#cb31-562" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"black"</span>)) <span class="sc">+</span></span>
<span id="cb31-563"><a href="#cb31-563" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"black"</span>)) <span class="sc">+</span></span>
<span id="cb31-564"><a href="#cb31-564" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"t"</span>, <span class="at">y =</span> <span class="st">"Pr(X &lt; t)"</span>, <span class="at">color =</span> <span class="st">""</span>, <span class="at">fill =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb31-565"><a href="#cb31-565" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>) </span>
<span id="cb31-566"><a href="#cb31-566" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb31-567"><a href="#cb31-567" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-568"><a href="#cb31-568" aria-hidden="true" tabindex="-1"></a>How do we interpret these intervals? *For each separate* $x_0$ there is a 95% chance our interval contains the true value $F_X(x_0)$. It is not the case that there is a 95% chance that the entire function $\hat F_X$ is contained in the interval, because we're not considering the behavior of $\hat F_X$ as a function yet.</span>
<span id="cb31-569"><a href="#cb31-569" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-570"><a href="#cb31-570" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-571"><a href="#cb31-571" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-572"><a href="#cb31-572" aria-hidden="true" tabindex="-1"></a><span class="fu">### Empirical Process Theory</span></span>
<span id="cb31-573"><a href="#cb31-573" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-574"><a href="#cb31-574" aria-hidden="true" tabindex="-1"></a>Let's now change gears and consider the properties of $\hat F_X$ as a function, and not just the properties of $\hat F_X(x_0)$ for some fixed $x_0$. The study of $\hat F_X$ as an entire function is the subject of *empirical process theory*, which is a fairly technical branch of asymptotic theory.</span>
<span id="cb31-575"><a href="#cb31-575" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-576"><a href="#cb31-576" aria-hidden="true" tabindex="-1"></a>::: {#def-}</span>
<span id="cb31-577"><a href="#cb31-577" aria-hidden="true" tabindex="-1"></a>The function $t \mapsto \hat F_X(t)$ is an <span class="kw">&lt;span</span> <span class="er">style</span><span class="ot">=</span><span class="st">"color:red"</span><span class="kw">&gt;</span>**_empirical process_**<span class="kw">&lt;/span&gt;</span>. </span>
<span id="cb31-578"><a href="#cb31-578" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-579"><a href="#cb31-579" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-580"><a href="#cb31-580" aria-hidden="true" tabindex="-1"></a>When considering the properties of $\hat F_X$ as an empirical process, we need to think about it as an element of a space of functions. Instead of looking at the discrepancy of $\hat F_X(t) - F_X(t)$ for a fixed $t$, we will work with </span>
<span id="cb31-581"><a href="#cb31-581" aria-hidden="true" tabindex="-1"></a>$$\norm{\hat F_X - F_X}_p = \left(\int_{\mathcal X} \abs{\hat F_X(t) - F_X(t)}^p\ dt \right)^{1/p}.$$ In particular, we'll focus on the case where $p=\infty$, $$\norm{\hat F_X - F_X}_\infty = \sup_{t\in\mathcal X}\abs{\hat F_X(t) - F_X(t)}.$$ Not only is the supremum norm the conservative choice because it assess $\hat F_X$ at the point where the discrepancy $\abs{\hat F_X(t) - F_X(t)}$ is the "largest"^[Kind of but not really because $\sup$ instead of $\max$.], but $\norm{\cdot}_\infty$ is also used to define uniform convergence.</span>
<span id="cb31-582"><a href="#cb31-582" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-583"><a href="#cb31-583" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-584"><a href="#cb31-584" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-585"><a href="#cb31-585" aria-hidden="true" tabindex="-1"></a>The first, and perhaps most important, result about $\hat F_X(t)$'s behavior as a function of $t$ involves consistency. We know that $\hat F_X(t)\pto F_X(t)$ for each separate $t$, but does this convergence occur uniformly for all $t$?</span>
<span id="cb31-586"><a href="#cb31-586" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-587"><a href="#cb31-587" aria-hidden="true" tabindex="-1"></a>As famously shown by @glivenko1933sulla and @cantelli. </span>
<span id="cb31-588"><a href="#cb31-588" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-589"><a href="#cb31-589" aria-hidden="true" tabindex="-1"></a>::: {#thm-}</span>
<span id="cb31-590"><a href="#cb31-590" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-591"><a href="#cb31-591" aria-hidden="true" tabindex="-1"></a><span class="fu">## Glivenko-Cantelli</span></span>
<span id="cb31-592"><a href="#cb31-592" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-593"><a href="#cb31-593" aria-hidden="true" tabindex="-1"></a>If $X_1,\ldots,X_n$ are IID random variables with a distribution $F_X$, then </span>
<span id="cb31-594"><a href="#cb31-594" aria-hidden="true" tabindex="-1"></a>$$ \norm{\hat F_X - F_X}_\infty \pto 0.$$ </span>
<span id="cb31-595"><a href="#cb31-595" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-596"><a href="#cb31-596" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-597"><a href="#cb31-597" aria-hidden="true" tabindex="-1"></a>::: {.proof}</span>
<span id="cb31-598"><a href="#cb31-598" aria-hidden="true" tabindex="-1"></a>See </span>
<span id="cb31-599"><a href="#cb31-599" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-600"><a href="#cb31-600" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-601"><a href="#cb31-601" aria-hidden="true" tabindex="-1"></a>::: {#exm-}</span>
<span id="cb31-602"><a href="#cb31-602" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-603"><a href="#cb31-603" aria-hidden="true" tabindex="-1"></a>If we take the Glivenko-Cantelli theorem at face value, then illustrating it is a matter of looking at $\norm{\hat F_X - F_X}_\infty$ for simulated samples of increasing size $n$.</span>
<span id="cb31-604"><a href="#cb31-604" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-607"><a href="#cb31-607" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb31-608"><a href="#cb31-608" aria-hidden="true" tabindex="-1"></a>N_sim <span class="ot">&lt;-</span> <span class="fl">1e3</span></span>
<span id="cb31-609"><a href="#cb31-609" aria-hidden="true" tabindex="-1"></a>sup_diff <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">"numeric"</span>, N_sim)</span>
<span id="cb31-610"><a href="#cb31-610" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (n <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>N_sim) {</span>
<span id="cb31-611"><a href="#cb31-611" aria-hidden="true" tabindex="-1"></a>  X <span class="ot">&lt;-</span> <span class="fu">draw_X</span>(n)</span>
<span id="cb31-612"><a href="#cb31-612" aria-hidden="true" tabindex="-1"></a>  F_hat <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="fu">seq</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">12</span>, <span class="at">length =</span> <span class="fl">1e5</span>), emp_dist, <span class="at">sample =</span> X)</span>
<span id="cb31-613"><a href="#cb31-613" aria-hidden="true" tabindex="-1"></a>  F_0 <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="fu">seq</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">12</span>, <span class="at">length =</span> <span class="fl">1e5</span>), F_X)</span>
<span id="cb31-614"><a href="#cb31-614" aria-hidden="true" tabindex="-1"></a>  sup_diff[n] <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="fu">abs</span>(F_hat <span class="sc">-</span> F_0))</span>
<span id="cb31-615"><a href="#cb31-615" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-616"><a href="#cb31-616" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb31-617"><a href="#cb31-617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-620"><a href="#cb31-620" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb31-621"><a href="#cb31-621" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb31-622"><a href="#cb31-622" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb31-623"><a href="#cb31-623" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-plot412e1741923</span></span>
<span id="cb31-624"><a href="#cb31-624" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-align: center</span></span>
<span id="cb31-625"><a href="#cb31-625" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-asp: 0.7</span></span>
<span id="cb31-626"><a href="#cb31-626" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 8</span></span>
<span id="cb31-627"><a href="#cb31-627" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: " "</span></span>
<span id="cb31-628"><a href="#cb31-628" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Show code which generates figure"</span></span>
<span id="cb31-629"><a href="#cb31-629" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(</span>
<span id="cb31-630"><a href="#cb31-630" aria-hidden="true" tabindex="-1"></a>  <span class="at">n =</span> <span class="dv">1</span><span class="sc">:</span>N_sim,</span>
<span id="cb31-631"><a href="#cb31-631" aria-hidden="true" tabindex="-1"></a>  sup_diff</span>
<span id="cb31-632"><a href="#cb31-632" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-633"><a href="#cb31-633" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(n, sup_diff)) <span class="sc">+</span></span>
<span id="cb31-634"><a href="#cb31-634" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span> </span>
<span id="cb31-635"><a href="#cb31-635" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb31-636"><a href="#cb31-636" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"sup |eCDF - CDF|"</span>, <span class="at">x =</span><span class="st">"Sample Size, n"</span>) <span class="sc">+</span></span>
<span id="cb31-637"><a href="#cb31-637" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() </span>
<span id="cb31-638"><a href="#cb31-638" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb31-639"><a href="#cb31-639" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-640"><a href="#cb31-640" aria-hidden="true" tabindex="-1"></a>While this illustration corroborates the Glivenko-Cantelli theorem, it doesn't look at it through the lens that matters. A better way to visualize the theorem is by looking at how the shape of $\hat F_X$ behaves as $n\to\infty$. </span>
<span id="cb31-641"><a href="#cb31-641" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-644"><a href="#cb31-644" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb31-645"><a href="#cb31-645" aria-hidden="true" tabindex="-1"></a>estimates <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb31-646"><a href="#cb31-646" aria-hidden="true" tabindex="-1"></a>iter <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb31-647"><a href="#cb31-647" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (n <span class="cf">in</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">25</span>, <span class="dv">50</span>, <span class="dv">100</span>, <span class="dv">500</span>, <span class="dv">1000</span>)) {</span>
<span id="cb31-648"><a href="#cb31-648" aria-hidden="true" tabindex="-1"></a>  iter <span class="ot">&lt;-</span> iter <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb31-649"><a href="#cb31-649" aria-hidden="true" tabindex="-1"></a>  X <span class="ot">&lt;-</span> <span class="fu">draw_X</span>(n)</span>
<span id="cb31-650"><a href="#cb31-650" aria-hidden="true" tabindex="-1"></a>  F_hat <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="fu">seq</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">12</span>, <span class="at">length =</span> <span class="fl">1e5</span>), emp_dist, <span class="at">sample =</span> X)</span>
<span id="cb31-651"><a href="#cb31-651" aria-hidden="true" tabindex="-1"></a>  estimates[[iter]] <span class="ot">&lt;-</span> <span class="fu">tibble</span>(F_hat, n , <span class="at">x =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">12</span>, <span class="at">length =</span> <span class="fl">1e5</span>))</span>
<span id="cb31-652"><a href="#cb31-652" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-653"><a href="#cb31-653" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb31-654"><a href="#cb31-654" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-655"><a href="#cb31-655" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-658"><a href="#cb31-658" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb31-659"><a href="#cb31-659" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb31-660"><a href="#cb31-660" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb31-661"><a href="#cb31-661" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-plot412e17412849</span></span>
<span id="cb31-662"><a href="#cb31-662" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-align: center</span></span>
<span id="cb31-663"><a href="#cb31-663" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-asp: 0.7</span></span>
<span id="cb31-664"><a href="#cb31-664" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 8</span></span>
<span id="cb31-665"><a href="#cb31-665" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: " "</span></span>
<span id="cb31-666"><a href="#cb31-666" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Show code which generates figure"</span></span>
<span id="cb31-667"><a href="#cb31-667" aria-hidden="true" tabindex="-1"></a>estimates <span class="sc">%&gt;%</span> </span>
<span id="cb31-668"><a href="#cb31-668" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb31-669"><a href="#cb31-669" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(x, F_hat)) <span class="sc">+</span></span>
<span id="cb31-670"><a href="#cb31-670" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span> </span>
<span id="cb31-671"><a href="#cb31-671" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>n) <span class="sc">+</span></span>
<span id="cb31-672"><a href="#cb31-672" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_function</span>(<span class="at">fun =</span> F_X, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb31-673"><a href="#cb31-673" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb31-674"><a href="#cb31-674" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb31-675"><a href="#cb31-675" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-676"><a href="#cb31-676" aria-hidden="true" tabindex="-1"></a>As $n\to\infty$, it does in fact appear that the empirical distribution $\hat F_X$ converges to the true distribution $F_X$ *uniformly*, and not just pointwise. </span>
<span id="cb31-677"><a href="#cb31-677" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-678"><a href="#cb31-678" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-679"><a href="#cb31-679" aria-hidden="true" tabindex="-1"></a>The key theorem in empirical process theory gives the limiting distribution of the standardized empirical process $\sqrt{n}(\hat F_X - F)$. We already know that $$\sqrt n<span class="co">[</span><span class="ot">\hat F_X(x_0)-  F_X(x_0)</span><span class="co">]</span> \dto N(0, F_X(x_0)(1-F_X(x_0)))$$ for all fixed $x_0$, but showing the analogous result for the empirical process $\sqrt{n}(\hat F_X - F)$ requires a bit more care. One needs to make sure that $\hat F_X$ "behaves well" on its support.^<span class="co">[</span><span class="ot">In this case behaves well means that the sequence $\hat F_X$ over sample sizes $n$ is **_asymptotically/stochastically equicontinuous_**. If you've taken a real analysis course, the term equicontinuity may seem familiar as it's an extension of uniform continuity to a collection of functions. If the collection of $\hat F_X$ over sample sizes $n$ is asymptotically equicontinuous, then for all $n$, $\hat F_X$ converges uniformly in probability. The magic of uniform convergence is it allows us to interchange many limiting processes, and in this case allows us to conclude that the entire empirical process converges to something related to a normal distribution.</span><span class="co">]</span> @hansen2022probability provides a nice discussion of this, while omitting many of the technical details that can be found in @van2000asymptotic.</span>
<span id="cb31-680"><a href="#cb31-680" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-681"><a href="#cb31-681" aria-hidden="true" tabindex="-1"></a>::: {#thm-donsk}</span>
<span id="cb31-682"><a href="#cb31-682" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-683"><a href="#cb31-683" aria-hidden="true" tabindex="-1"></a><span class="fu">## Donsker's Theorem</span></span>
<span id="cb31-684"><a href="#cb31-684" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-685"><a href="#cb31-685" aria-hidden="true" tabindex="-1"></a>If $X_1,\ldots,X_n$ are IID random variables with a distribution $F_X$, then </span>
<span id="cb31-686"><a href="#cb31-686" aria-hidden="true" tabindex="-1"></a>$$ \sqrt{n}.$$ </span>
<span id="cb31-687"><a href="#cb31-687" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-688"><a href="#cb31-688" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-689"><a href="#cb31-689" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-690"><a href="#cb31-690" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-691"><a href="#cb31-691" aria-hidden="true" tabindex="-1"></a>::: {.proof}</span>
<span id="cb31-692"><a href="#cb31-692" aria-hidden="true" tabindex="-1"></a>See Theorem 19.3 and Theorem 19.5 of @van2000asymptotic.</span>
<span id="cb31-693"><a href="#cb31-693" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-694"><a href="#cb31-694" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-695"><a href="#cb31-695" aria-hidden="true" tabindex="-1"></a>@massart1990tight </span>
<span id="cb31-696"><a href="#cb31-696" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-697"><a href="#cb31-697" aria-hidden="true" tabindex="-1"></a>::: {#prp-}</span>
<span id="cb31-698"><a href="#cb31-698" aria-hidden="true" tabindex="-1"></a><span class="fu">## DKW Inequality</span></span>
<span id="cb31-699"><a href="#cb31-699" aria-hidden="true" tabindex="-1"></a>See</span>
<span id="cb31-700"><a href="#cb31-700" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-701"><a href="#cb31-701" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-702"><a href="#cb31-702" aria-hidden="true" tabindex="-1"></a>::: {.proof}</span>
<span id="cb31-703"><a href="#cb31-703" aria-hidden="true" tabindex="-1"></a>See @massart1990tight.</span>
<span id="cb31-704"><a href="#cb31-704" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-705"><a href="#cb31-705" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-706"><a href="#cb31-706" aria-hidden="true" tabindex="-1"></a>::: {#exm-}</span>
<span id="cb31-707"><a href="#cb31-707" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-708"><a href="#cb31-708" aria-hidden="true" tabindex="-1"></a><span class="fu">## Confidence Bands</span></span>
<span id="cb31-709"><a href="#cb31-709" aria-hidden="true" tabindex="-1"></a>t</span>
<span id="cb31-710"><a href="#cb31-710" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-711"><a href="#cb31-711" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-712"><a href="#cb31-712" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-713"><a href="#cb31-713" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-716"><a href="#cb31-716" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb31-717"><a href="#cb31-717" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb31-718"><a href="#cb31-718" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">draw_X</span>(n)</span>
<span id="cb31-719"><a href="#cb31-719" aria-hidden="true" tabindex="-1"></a>F_hat <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="fu">seq</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">12</span>, <span class="at">length =</span> <span class="fl">1e5</span>), emp_dist, <span class="at">sample =</span> X)</span>
<span id="cb31-720"><a href="#cb31-720" aria-hidden="true" tabindex="-1"></a>F_0 <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="fu">seq</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">12</span>, <span class="at">length =</span> <span class="fl">1e5</span>), F_X)</span>
<span id="cb31-721"><a href="#cb31-721" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-722"><a href="#cb31-722" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(</span>
<span id="cb31-723"><a href="#cb31-723" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">12</span>, <span class="at">length =</span> <span class="fl">1e5</span>),</span>
<span id="cb31-724"><a href="#cb31-724" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> <span class="fu">sqrt</span>(n) <span class="sc">*</span> (F_hat <span class="sc">-</span> F_0)</span>
<span id="cb31-725"><a href="#cb31-725" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-726"><a href="#cb31-726" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(x,y)) <span class="sc">+</span></span>
<span id="cb31-727"><a href="#cb31-727" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb31-728"><a href="#cb31-728" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb31-729"><a href="#cb31-729" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb31-730"><a href="#cb31-730" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-731"><a href="#cb31-731" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-732"><a href="#cb31-732" aria-hidden="true" tabindex="-1"></a>::: {#prp-}</span>
<span id="cb31-733"><a href="#cb31-733" aria-hidden="true" tabindex="-1"></a><span class="fu">## Goodness of Fit Statistics</span></span>
<span id="cb31-734"><a href="#cb31-734" aria-hidden="true" tabindex="-1"></a>t</span>
<span id="cb31-735"><a href="#cb31-735" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-736"><a href="#cb31-736" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-737"><a href="#cb31-737" aria-hidden="true" tabindex="-1"></a>::: {.proof}</span>
<span id="cb31-738"><a href="#cb31-738" aria-hidden="true" tabindex="-1"></a>See Corollary 19.21 of @van2000asymptotic. The proof amounts to an application of the continuous mapping theorem to @thm-donsk. </span>
<span id="cb31-739"><a href="#cb31-739" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-740"><a href="#cb31-740" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-741"><a href="#cb31-741" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-742"><a href="#cb31-742" aria-hidden="true" tabindex="-1"></a>::: {.proof}</span>
<span id="cb31-743"><a href="#cb31-743" aria-hidden="true" tabindex="-1"></a>See Corollary 19.21 of @van2000asymptotic. The proof amounts to an application of the continuous mapping theorem to @thm-donsk. </span>
<span id="cb31-744"><a href="#cb31-744" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-745"><a href="#cb31-745" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-746"><a href="#cb31-746" aria-hidden="true" tabindex="-1"></a><span class="fu">## From Estimating Distributions to Estimating Densities </span></span>
<span id="cb31-747"><a href="#cb31-747" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-748"><a href="#cb31-748" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-749"><a href="#cb31-749" aria-hidden="true" tabindex="-1"></a>::: {#def-}</span>
<span id="cb31-750"><a href="#cb31-750" aria-hidden="true" tabindex="-1"></a>A <span class="kw">&lt;span</span> <span class="er">style</span><span class="ot">=</span><span class="st">"color:red"</span><span class="kw">&gt;</span>**_kernel function_**<span class="kw">&lt;/span&gt;</span> $K:\R\to\R$ is a function satisfying</span>
<span id="cb31-751"><a href="#cb31-751" aria-hidden="true" tabindex="-1"></a>$$ \int_{-\infty}^\infty K(u)\ du = 1.$$ It is often convenient to assume $K$ is nonnegative, and symmetric:</span>
<span id="cb31-752"><a href="#cb31-752" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb31-753"><a href="#cb31-753" aria-hidden="true" tabindex="-1"></a>K(u) &amp; = K(-u) &amp; \forall u\in \R<span class="sc">\\</span></span>
<span id="cb31-754"><a href="#cb31-754" aria-hidden="true" tabindex="-1"></a>K(u) &amp; \ge 0 &amp; \forall u\in \R</span>
<span id="cb31-755"><a href="#cb31-755" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb31-756"><a href="#cb31-756" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-757"><a href="#cb31-757" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-758"><a href="#cb31-758" aria-hidden="true" tabindex="-1"></a>::: {.remark}</span>
<span id="cb31-759"><a href="#cb31-759" aria-hidden="true" tabindex="-1"></a>This definition of a kernel function in this context is *very specific*. In general, kernels are generalized versions of positive-definite functions and positive-definite matrices. For instance, when working with spaces of functions there are many situations where we want to apply a transformation to some function $f$ via integration, giving us another function using some "kernel function" $K$:</span>
<span id="cb31-760"><a href="#cb31-760" aria-hidden="true" tabindex="-1"></a>$$ (Tf)(u) = \int_{a}^{b}f(x)\cdot K(u,x)\ dx$$ On famous example of such a transform is the Fourier transform of a function $f$, given as</span>
<span id="cb31-761"><a href="#cb31-761" aria-hidden="true" tabindex="-1"></a>$$ \tilde f(t) = \int_{-\infty}^\infty f(x)\cdot e^{-i2\pi t x}\ dx.$$ In this case the kernel function is $K(u,x)=e^{-i2\pi t x}$. Kernel transformations also appear in probability and statistics,^<span class="co">[</span><span class="ot">This is not to say that the Fourier transformation doesn't play an important role in probability and statistics. In fact, quite the opposite. The Fourier transformation of a density function is the **_characteristic function_**of a random variable, a function with some magical properties.</span><span class="co">]</span> The density of the sum of two independent random variables, say $Z = Y + X$, is given as</span>
<span id="cb31-762"><a href="#cb31-762" aria-hidden="true" tabindex="-1"></a>$$ f_Z(t) = \int_{-\infty}^\infty f_X(x)\cdot f_Y(u-x)\ dx.$$ The kernel associated with this transformation is $K(u,x)= f_Y(u-x)$. </span>
<span id="cb31-763"><a href="#cb31-763" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-764"><a href="#cb31-764" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-765"><a href="#cb31-765" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-766"><a href="#cb31-766" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-767"><a href="#cb31-767" aria-hidden="true" tabindex="-1"></a>::: {#def-}</span>
<span id="cb31-768"><a href="#cb31-768" aria-hidden="true" tabindex="-1"></a>KDE estimator</span>
<span id="cb31-769"><a href="#cb31-769" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-770"><a href="#cb31-770" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-771"><a href="#cb31-771" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-772"><a href="#cb31-772" aria-hidden="true" tabindex="-1"></a>::: {.remark}</span>
<span id="cb31-773"><a href="#cb31-773" aria-hidden="true" tabindex="-1"></a>convolution </span>
<span id="cb31-774"><a href="#cb31-774" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-775"><a href="#cb31-775" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb31-776"><a href="#cb31-776" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-779"><a href="#cb31-779" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb31-780"><a href="#cb31-780" aria-hidden="true" tabindex="-1"></a>kde <span class="ot">&lt;-</span> <span class="cf">function</span>(x, sample, K, h){</span>
<span id="cb31-781"><a href="#cb31-781" aria-hidden="true" tabindex="-1"></a>  <span class="co"># sample size</span></span>
<span id="cb31-782"><a href="#cb31-782" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">length</span>(sample)</span>
<span id="cb31-783"><a href="#cb31-783" aria-hidden="true" tabindex="-1"></a>  <span class="co">#calculate the kernel density estimate at x</span></span>
<span id="cb31-784"><a href="#cb31-784" aria-hidden="true" tabindex="-1"></a>  (<span class="dv">1</span><span class="sc">/</span>(n<span class="sc">*</span>h)) <span class="sc">*</span> <span class="fu">sum</span>(<span class="fu">K</span>((x <span class="sc">-</span> sample)<span class="sc">/</span>h))</span>
<span id="cb31-785"><a href="#cb31-785" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-786"><a href="#cb31-786" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb31-787"><a href="#cb31-787" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-790"><a href="#cb31-790" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb31-791"><a href="#cb31-791" aria-hidden="true" tabindex="-1"></a>uniform <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb31-792"><a href="#cb31-792" aria-hidden="true" tabindex="-1"></a>  (<span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>)<span class="sc">*</span>(<span class="fu">abs</span>(x) <span class="sc">&lt;=</span> <span class="dv">1</span>)</span>
<span id="cb31-793"><a href="#cb31-793" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-794"><a href="#cb31-794" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-795"><a href="#cb31-795" aria-hidden="true" tabindex="-1"></a>triangular <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb31-796"><a href="#cb31-796" aria-hidden="true" tabindex="-1"></a>  (<span class="dv">1</span> <span class="sc">-</span> <span class="fu">abs</span>(x))<span class="sc">*</span>(<span class="fu">abs</span>(x) <span class="sc">&lt;=</span> <span class="dv">1</span>)</span>
<span id="cb31-797"><a href="#cb31-797" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-798"><a href="#cb31-798" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-799"><a href="#cb31-799" aria-hidden="true" tabindex="-1"></a>triweight <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb31-800"><a href="#cb31-800" aria-hidden="true" tabindex="-1"></a>  (<span class="dv">35</span><span class="sc">/</span><span class="dv">32</span><span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>x<span class="sc">^</span><span class="dv">2</span>)<span class="sc">^</span><span class="dv">3</span>)<span class="sc">*</span>(<span class="fu">abs</span>(x) <span class="sc">&lt;=</span> <span class="dv">1</span>)</span>
<span id="cb31-801"><a href="#cb31-801" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-802"><a href="#cb31-802" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-803"><a href="#cb31-803" aria-hidden="true" tabindex="-1"></a>gauss <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb31-804"><a href="#cb31-804" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dnorm</span>(x)</span>
<span id="cb31-805"><a href="#cb31-805" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-806"><a href="#cb31-806" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb31-807"><a href="#cb31-807" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-808"><a href="#cb31-808" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-811"><a href="#cb31-811" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb31-812"><a href="#cb31-812" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb31-813"><a href="#cb31-813" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-align: center</span></span>
<span id="cb31-814"><a href="#cb31-814" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-asp: 1</span></span>
<span id="cb31-815"><a href="#cb31-815" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 11</span></span>
<span id="cb31-816"><a href="#cb31-816" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Distribution of estimators for the population variance"</span></span>
<span id="cb31-817"><a href="#cb31-817" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Show code which generates figure"</span></span>
<span id="cb31-818"><a href="#cb31-818" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-819"><a href="#cb31-819" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(</span>
<span id="cb31-820"><a href="#cb31-820" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">2</span>, <span class="dv">2</span>, <span class="at">length =</span> <span class="dv">10000</span>),</span>
<span id="cb31-821"><a href="#cb31-821" aria-hidden="true" tabindex="-1"></a>  <span class="at">Uniform =</span> <span class="fu">uniform</span>(x),</span>
<span id="cb31-822"><a href="#cb31-822" aria-hidden="true" tabindex="-1"></a>  <span class="at">Triangular =</span> <span class="fu">triangular</span>(x),</span>
<span id="cb31-823"><a href="#cb31-823" aria-hidden="true" tabindex="-1"></a>  <span class="at">Triweight =</span> <span class="fu">triweight</span>(x),</span>
<span id="cb31-824"><a href="#cb31-824" aria-hidden="true" tabindex="-1"></a>  <span class="at">Gaussian =</span> <span class="fu">gauss</span>(x)</span>
<span id="cb31-825"><a href="#cb31-825" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-826"><a href="#cb31-826" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gather</span>(<span class="st">"Kernel"</span>, <span class="st">"val"</span>, <span class="sc">-</span>x) <span class="sc">%&gt;%</span> </span>
<span id="cb31-827"><a href="#cb31-827" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(x, val, <span class="at">color =</span> Kernel)) <span class="sc">+</span></span>
<span id="cb31-828"><a href="#cb31-828" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb31-829"><a href="#cb31-829" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb31-830"><a href="#cb31-830" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>) <span class="sc">+</span></span>
<span id="cb31-831"><a href="#cb31-831" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Density"</span>)</span>
<span id="cb31-832"><a href="#cb31-832" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb31-833"><a href="#cb31-833" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-836"><a href="#cb31-836" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb31-837"><a href="#cb31-837" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">draw_X</span>(<span class="dv">1000</span>)</span>
<span id="cb31-838"><a href="#cb31-838" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-839"><a href="#cb31-839" aria-hidden="true" tabindex="-1"></a><span class="co">#set elements to loop over and support to calculate KDE on </span></span>
<span id="cb31-840"><a href="#cb31-840" aria-hidden="true" tabindex="-1"></a>kernels <span class="ot">&lt;-</span> <span class="fu">c</span>(uniform, triangular, triweight, gauss)</span>
<span id="cb31-841"><a href="#cb31-841" aria-hidden="true" tabindex="-1"></a>kernel_names <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Uniform"</span>, <span class="st">"Triangular"</span>, <span class="st">"Triweight"</span>, <span class="st">"Gaussian"</span>)</span>
<span id="cb31-842"><a href="#cb31-842" aria-hidden="true" tabindex="-1"></a>bandwidths <span class="ot">&lt;-</span> <span class="fu">c</span>(.<span class="dv">05</span>, .<span class="dv">1</span>, .<span class="dv">5</span>, <span class="fl">0.75</span>, <span class="dv">1</span>, <span class="dv">2</span>)</span>
<span id="cb31-843"><a href="#cb31-843" aria-hidden="true" tabindex="-1"></a>support <span class="ot">&lt;-</span><span class="fu">seq</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">12</span>, <span class="at">length =</span> <span class="fl">1e3</span>)</span>
<span id="cb31-844"><a href="#cb31-844" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-845"><a href="#cb31-845" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-846"><a href="#cb31-846" aria-hidden="true" tabindex="-1"></a>estimates <span class="ot">&lt;-</span> <span class="fu">expand_grid</span>(<span class="at">x =</span> support, </span>
<span id="cb31-847"><a href="#cb31-847" aria-hidden="true" tabindex="-1"></a>            <span class="at">h =</span> bandwidths, </span>
<span id="cb31-848"><a href="#cb31-848" aria-hidden="true" tabindex="-1"></a>            <span class="at">ker_index =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span></span>
<span id="cb31-849"><a href="#cb31-849" aria-hidden="true" tabindex="-1"></a>            ) <span class="sc">%&gt;%</span> </span>
<span id="cb31-850"><a href="#cb31-850" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb31-851"><a href="#cb31-851" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb31-852"><a href="#cb31-852" aria-hidden="true" tabindex="-1"></a>    <span class="at">f_est =</span> <span class="fu">kde</span>(x, <span class="at">sample =</span> X, <span class="at">K =</span> kernels[[ker_index]], h),</span>
<span id="cb31-853"><a href="#cb31-853" aria-hidden="true" tabindex="-1"></a>    <span class="at">Kernel =</span> kernel_names[ker_index]</span>
<span id="cb31-854"><a href="#cb31-854" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb31-855"><a href="#cb31-855" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-856"><a href="#cb31-856" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb31-857"><a href="#cb31-857" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-858"><a href="#cb31-858" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-861"><a href="#cb31-861" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb31-862"><a href="#cb31-862" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb31-863"><a href="#cb31-863" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-align: center</span></span>
<span id="cb31-864"><a href="#cb31-864" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-asp: 1</span></span>
<span id="cb31-865"><a href="#cb31-865" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 11</span></span>
<span id="cb31-866"><a href="#cb31-866" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Distribution of estimators for the population variance"</span></span>
<span id="cb31-867"><a href="#cb31-867" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Show code which generates figure"</span></span>
<span id="cb31-868"><a href="#cb31-868" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-869"><a href="#cb31-869" aria-hidden="true" tabindex="-1"></a>estimates <span class="sc">%&gt;%</span> </span>
<span id="cb31-870"><a href="#cb31-870" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">h =</span> <span class="fu">paste</span>(<span class="st">"h ="</span>, h)) <span class="sc">%&gt;%</span> </span>
<span id="cb31-871"><a href="#cb31-871" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(x, f_est, <span class="at">color =</span> Kernel)) <span class="sc">+</span></span>
<span id="cb31-872"><a href="#cb31-872" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb31-873"><a href="#cb31-873" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(<span class="at">fun =</span> f_X, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span> </span>
<span id="cb31-874"><a href="#cb31-874" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>h) <span class="sc">+</span></span>
<span id="cb31-875"><a href="#cb31-875" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb31-876"><a href="#cb31-876" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color =</span> <span class="st">"Kernel"</span>, <span class="at">y =</span> <span class="st">"Kernel Density Estimate"</span>) <span class="sc">+</span></span>
<span id="cb31-877"><a href="#cb31-877" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb31-878"><a href="#cb31-878" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb31-879"><a href="#cb31-879" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-880"><a href="#cb31-880" aria-hidden="true" tabindex="-1"></a><span class="fu">## Properties of the Kernel Density Estimator </span></span>
<span id="cb31-881"><a href="#cb31-881" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-882"><a href="#cb31-882" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-883"><a href="#cb31-883" aria-hidden="true" tabindex="-1"></a><span class="fu">## Kernel Selection</span></span>
<span id="cb31-884"><a href="#cb31-884" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-885"><a href="#cb31-885" aria-hidden="true" tabindex="-1"></a><span class="fu">## Bandwidth Selection</span></span>
<span id="cb31-886"><a href="#cb31-886" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-887"><a href="#cb31-887" aria-hidden="true" tabindex="-1"></a><span class="fu">### Silverman's Rule of Thumb</span></span>
<span id="cb31-888"><a href="#cb31-888" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-889"><a href="#cb31-889" aria-hidden="true" tabindex="-1"></a><span class="fu">### Cross-Validation</span></span>
<span id="cb31-890"><a href="#cb31-890" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-891"><a href="#cb31-891" aria-hidden="true" tabindex="-1"></a><span class="fu">## Multivariate KDE</span></span>
<span id="cb31-892"><a href="#cb31-892" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-893"><a href="#cb31-893" aria-hidden="true" tabindex="-1"></a><span class="fu">## Extensions</span></span>
<span id="cb31-894"><a href="#cb31-894" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-895"><a href="#cb31-895" aria-hidden="true" tabindex="-1"></a><span class="fu">## Further Reading</span></span>
<span id="cb31-896"><a href="#cb31-896" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-897"><a href="#cb31-897" aria-hidden="true" tabindex="-1"></a>**_Empirical Process Theory_**: Chapter 19 of @van2000asymptotic, Chapter 18 of @hansen2022probability, <span class="co">[</span><span class="ot">these notes</span><span class="co">](http://www.stat.columbia.edu/~bodhi/Talks/Emp-Proc-Lecture-Notes.pdf)</span>, or <span class="co">[</span><span class="ot">these notes</span><span class="co">](https://sites.stat.washington.edu/people/jaw/RESEARCH/TALKS/Delft/emp-proc-delft-big.pdf)</span></span>
<span id="cb31-898"><a href="#cb31-898" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-899"><a href="#cb31-899" aria-hidden="true" tabindex="-1"></a>**_Kernels_**: https://www.randomservices.org/random/expect/Kernels.html</span>
<span id="cb31-900"><a href="#cb31-900" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-901"><a href="#cb31-901" aria-hidden="true" tabindex="-1"></a>chrome-extension://efaidnbmnnnibpcajpcglclefindmkaj/http://amadeus.csam.iit.edu/~fass/PDKernels.pdf</span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>